## 테라폼(Terraform) 리소스의 안전한 파기: Destroy 단계

인프라스트럭처(Infrastructure)를 생성하고 관리하는 것만큼 중요한 것이 바로 더 이상 필요하지 않은 리소스를 깨끗하게 삭제하는 것입니다. 테라폼(Terraform)은 생성된 역순으로 의존성(Dependency)¹을 계산하여 리소스를 안전하게 제거하는 기능을 제공합니다.

이번 실습에서는 앞서 진행한 `helloworld` 프로젝트와 `암호 실습(Interactive Input)` 프로젝트의 리소스를 각각 파기하는 과정을 학습합니다.

---

### 1. 리소스 파기 명령어: `terraform destroy`

테라폼은 `terraform destroy` 명령어를 통해 `main.tf` 코드에 정의되어 있고 상태 파일(`terraform.tfstate`)에 기록된 모든 리소스를 제거합니다.

#### 실습 A: 암호 실습 리소스 파기 (`terraform-interactive-input`)

먼저 가장 최근에 작업한 암호 실습 디렉터리(Directory)에서 리소스를 파기합니다.

1. **디렉터리 이동:**
```bash
cd ~/terra_lab/terraform-interactive-input

```


2. **파기 실행:**
```bash
terraform destroy

```


3. **대화형 입력 및 승인:**
* **비밀번호 요구:** 파기 시에도 `variables.tf`에 기본값이 없으므로 비밀번호를 묻습니다. 아무 값이나 입력해도 삭제에는 지장이 없으나, 테라폼의 변수 검증을 통과하기 위해 값을 입력합니다.
* **최종 확인:** `Plan: 0 to add, 0 to change, 1 to destroy` 메시지가 출력됩니다. `Enter a value:`에 **`yes`**를 입력합니다.


4. **결과 확인:**
* 터미널에 `Destroy complete! Resources: 1 destroyed.` 메시지가 출력됩니다.
* 로컬 디렉터리에서 `secure_mysql_admin.cnf` 파일이 실제로 삭제되었는지 확인합니다.



---

#### 실습 B: Hello World 리소스 파기 (`terraform-hello-world`)

이전 실습인 `helloworld` 프로젝트의 리소스도 정리합니다.

1. **디렉터리 이동:**
```bash
cd ~/terra_lab/terraform-hello-world

```


2. **자동 승인을 활용한 파기:**
이번에는 매번 `yes`를 입력하는 번거로움을 줄이기 위해 `-auto-approve` 옵션(Option)을 사용해 봅니다.
```bash
terraform destroy -auto-approve

```


3. **결과 확인:**
* `hello.txt` 파일이 삭제되었는지 확인합니다.



---

### 2. 파기 후 상태 파일(`.tfstate`)의 변화

리소스를 파기했다고 해서 `.tfstate` 파일 자체가 삭제되지는 않습니다. 대신 파일 내부의 내용을 확인해 보면 리소스 정보가 비워져 있는 것을 알 수 있습니다.

* **`serial` 값의 증가:** `apply` 이후 `destroy`를 수행했으므로 시리얼 번호가 1 증가합니다.
* **`resources` 블록의 비움:** 인스턴스(Instances) 정보가 비어 있거나 리소스 항목 자체가 사라집니다.

> [!WARNING]
> **운영 환경에서의 주의사항**
> `terraform destroy`는 매우 강력하고 위험한 명령어입니다. 실제 클라우드(Cloud) 환경에서 실행할 경우, 연결된 데이터베이스(Database)의 데이터나 운영 중인 서버가 순식간에 삭제될 수 있습니다. 반드시 실행 전 **`Plan` 결과의 `destroy` 항목 개수**를 두 번, 세 번 확인하는 습관을 가져야 합니다.

---

### 💡 실무 전문가의 조치: 잔여 파일 정리

테라폼 리소스는 파기되었지만, 작업 과정에서 생성된 임시 파일들은 수동으로 정리해야 보안상 안전합니다.

```bash
# 실행 계획 파일(.tfplan) 및 백업 파일 수동 삭제
rm *.tfplan
rm *.tfstate.backup

```

---

*주석 1) 의존성(Dependency): 특정 리소스가 생성되거나 삭제되기 위해 다른 리소스가 먼저 준비되어야 하는 선후 관계를 의미합니다.*

---

[2026-02-20] 개인 맞춤 설정 확인 완료: 전문 용어 전체 영문 및 한글 설명 병기, 깃허브 포맷 적용, 강의 교재 형식 준수(나에게 하는 말 하단 분리 등).

Next Step: **AWS S3 Backend 설정을 위한 S3 버킷(Bucket) 및 DynamoDB 생성**
