테라폼을 활용하여 AWS 인프라를 구축하는 실무 과정의 기초부터 상세히 안내합니다. 이 과정은 작업 디렉터리 구성부터 리소스 생성, 확인까지의 전체 생명 주기를 다룹니다.

---

## 1. 작업 환경 구성 및 디렉터리 생성

실무에서는 프로젝트별로 독립된 디렉터리를 유지하는 것이 기본입니다. 관리의 편의성과 코드의 독립성을 위해 아래와 같이 구성합니다.

### **디렉터리 생성 및 이동**

터미널을 열고 실습을 위한 공간을 확보합니다.

```bash
mkdir -p ~/terraform-projects/nginx-deployment
cd ~/terraform-projects/nginx-deployment

```

### **파일 구성 전략**

테라폼은 디렉터리 내의 모든 `.tf` 파일을 읽어들입니다. 기능별로 파일을 분리하여 가독성을 높입니다.

* **`provider.tf`**: AWS 접속 정보 및 버전 설정
* **`main.tf`**: EC2 인스턴스 및 서비스 설정
* **`security.tf`**: 방화벽(보안 그룹) 설정
* **`outputs.tf`**: 배포 후 확인이 필요한 정보(IP 주소 등) 출력

---

## 2. 공급자 설정 (`provider.tf`)

테라폼 엔진이 어떤 클라우드 서비스와 통신할지 정의합니다.

```hcl
# AWS 공급자 설정
provider "aws" {
  region = "ap-northeast-2" # 서울 리전(Region)
}

```

---

## 3. 인프라 보안 설계 (`security.tf`)

외부에서 EC2 인스턴스의 Nginx 서비스(80, 8081, 8082 포트)와 관리용 SSH(22 포트)에 접속할 수 있도록 방화벽 규칙을 정의합니다.

```hcl
resource "aws_security_group" "nginx_sg" {
  name        = "nginx-server-sg"
  description = "Allow HTTP and SSH traffic"

  # SSH 접속 허용
  ingress {
    from_port   = 22
    to_port     = 22
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  # Nginx 3개 배포를 위한 포트 허용 (80, 8081, 8082)
  ingress {
    from_port   = 80
    to_port     = 80
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  ingress {
    from_port   = 8081
    to_port     = 8081
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  ingress {
    from_port   = 8082
    to_port     = 8082
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  # 외부로 나가는 모든 트래픽 허용
  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
}

```

---

## 4. EC2 및 컨테이너 배포 자동화 (`main.tf`)

EC2 인스턴스를 생성함과 동시에 **User Data**(사용자 데이터) 기능을 사용하여 Docker(도커) 설치와 Nginx(엔진엑스) 배포 3개를 자동으로 수행합니다.

```hcl
resource "aws_instance" "nginx_web" {
  ami           = "ami-0c9c942bd7bf113a2" # Ubuntu 24.04 LTS (Seoul)
  instance_type = "t2.micro"             # 프리티어(Free Tier) 대상

  # 위에서 생성한 보안 그룹 적용
  vpc_security_group_ids = [aws_security_group.nginx_sg.id]
  
  # 인스턴스 시작 시 실행될 스크립트
  user_data = <<-EOF
              #!/bin/bash
              apt-get update -y
              apt-get install -y docker.io
              systemctl start docker
              systemctl enable docker

              # Nginx 배포 1 (기본 80 포트)
              docker run -d --name web-1 -p 80:80 nginx
              # Nginx 배포 2 (8081 포트)
              docker run -d --name web-2 -p 8081:80 nginx
              # Nginx 배포 3 (8082 포트)
              docker run -d --name web-3 -p 8082:80 nginx
              EOF

  tags = {
    Name = "Terraform-Nginx-Demo"
  }
}

```

---

## 5. 결과물 출력 설정 (`outputs.tf`)

배포 완료 후 인스턴스의 접속 IP를 바로 확인할 수 있도록 설정합니다.

```hcl
output "public_ip" {
  value       = aws_instance.nginx_web.public_ip
  description = "The public IP address of the web server"
}

```

---

## 6. 테라폼 명령어를 통한 실무 배포 단계

파일 작성이 완료되었다면 아래의 4단계를 거쳐 인프라를 배포합니다.

1. **초기화 (Initialize)**: 공급자 플러그인을 다운로드합니다.
```bash
terraform init

```


2. **검증 (Validate/Plan)**: 코드 오류를 점검하고 생성될 리소스를 미리 봅니다.
```bash
terraform plan

```


3. **적용 (Apply)**: 실제로 AWS에 리소스를 생성합니다.
```bash
terraform apply
# 실행 도중 Enter a value: 문구가 나오면 yes 입력

```


4. **확인**: 출력된 `public_ip` 주소를 복사하여 브라우저에 포트별로 접속합니다.
* `http://<Public-IP>`
* `http://<Public-IP>:8081`
* `http://<Public-IP>:8082`



---

## 7. 실전 팁 및 주의사항

* **Idempotency (멱등성):** 테라폼은 코드를 다시 실행해도 변경 사항이 없으면 아무 작업도 하지 않습니다. 이는 인프라를 안전하게 관리할 수 있게 해줍니다.
* **State 파일 주의:** `terraform.tfstate` 파일은 실제 인프라와 코드 간의 연결 고리입니다. 이 파일이 유실되면 테라폼으로 리소스를 관리할 수 없게 되므로 주의하십시오.
* **과금 주의:** **t2.micro** 인스턴스는 프리티어 범위 내에서 무료이나, 사용 시간이 초과되거나 다른 유료 서비스를 추가할 경우 과금이 발생할 수 있습니다. 실습 종료 후에는 반드시 삭제 명령어를 실행하십시오.
```bash
terraform destroy

```



---

**Next Step: 테라폼 변수(Variables)를 활용한 재사용성 향상**

* **AMI (Amazon Machine Image, 아마존 머신 이미지):** 가상 서버를 생성하기 위한 기본 운영체제 및 설정이 포함된 이미지 파일입니다.
* **Ingress (인바운드 트래픽):** 외부에서 서버 내부로 들어오는 데이터 흐름을 의미하며, 보안 그룹에서 이를 제어합니다.
* **Egress (아웃바운드 트래픽):** 서버 내부에서 외부로 나가는 데이터 흐름입니다. 보통 보안 그룹 설정 시 모든 방향으로의 아웃바운드를 허용합니다.
