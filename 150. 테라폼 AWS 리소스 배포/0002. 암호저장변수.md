이번 단계에서는 코드 내에 직접 암호를 적는 하드코딩(Hardcoding)을 피하고, 테라폼의 **민감한 변수(Sensitive Variables)** 처리 기능과 **변수 정의 파일(.tfvars)**을 활용하여 보안을 한 단계 강화하는 방법을 실습하겠습니다.

---

## 실습: 변수 분리 및 민감 정보 보호

이 실습의 목표는 실행 화면(CLI Output)에서 비밀번호가 노출되는 것을 방지하고, 설정 값을 코드와 분리하여 관리하는 아키텍처를 배우는 것입니다.

### 1. 변수 정의 및 민감 설정 (`variables.tf`)
```
mkdir terraform-variables-test
cd terraform-variables-test
```

비밀번호를 위한 변수를 별도로 선언합니다. 이때 `sensitive = true` 옵션을 사용하는 것이 핵심입니다.

```hcl
variable "db_admin_password" {
  description = "MySQL Employees DB 관리자 비밀번호"
  type        = string
  # sensitive를 true로 설정하면 terraform plan/apply 시 화면에 값이 표시되지 않습니다.
  sensitive   = true
}

```

### 2. 메인 코드 수정 (`main.tf`)

하드코딩했던 비밀번호 자리에 변수를 참조하도록 수정합니다.

```hcl
resource "local_file" "mysql_admin_config" {
  content  = <<EOF
[client]
host=mysql-employees-db.example.com
user=admin
password=${var.db_admin_password}
port=3306
EOF

  filename = "${path.module}/mysql_admin.cnf"
}

# 출력값에도 sensitive 속성이 전파됩니다.
output "db_password_output" {
  value     = var.db_admin_password
  sensitive = true
}

```

### 3. 변수 데이터 파일 작성 (`terraform.tfvars`)

실제 비밀번호 값은 Git에 올리지 않을 별도의 파일에 저장합니다. 테라폼은 확장자가 `.tfvars`인 파일을 자동으로 읽어옵니다.

```hcl
# 주의: 이 파일은 절대로 GitHub에 업로드하지 마세요.
db_admin_password = "EnhancedSecurityPass!2026"

```

---

## 실행 및 보안 검증

### 1. 명령어 실행

```bash
# 1. 초기화 (공급자 플러그인 설치)
terraform init

# 2. 실행 계획 확인 (비밀번호가 가려지는지 확인!)
terraform plan

# 3. 실행 적용
terraform apply 

```

**확인 포인트:** `plan` 결과 화면에서 `password`나 `output` 값이 실제 암호 대신 **`(sensitive value)`**로 표시되는지 확인하세요. 이것이 테라폼이 화면상에서 민감 정보를 가리는 방식입니다.

### 2. 적용

```bash
terraform apply -auto-approve

```

### 3. 상태 파일(`terraform.tfstate`) 재점검

이제 가장 중요한 보안 점검을 수행합니다.

```bash
cat terraform.tfstate

```

> [!IMPORTANT]
> **아키텍트의 분석 결과:**
> 화면(CLI)에서는 `(sensitive value)`라고 완벽하게 가려졌지만, **상태 파일(`terraform.tfstate`) 내부에는 여전히 `"EnhancedSecurityPass!2026"`이 평문으로 저장**되어 있습니다.
> 이는 테라폼의 `sensitive` 옵션이 **'화면 출력'**을 제한할 뿐, **'상태 저장'**까지 암호화하지는 못한다는 것을 증명합니다.

---

## 🛡️ 최종 보안 아키텍처 설계 제안

실무 전문가로서 이 보안 취약점을 완벽히 해결하기 위한 단계별 조치는 다음과 같습니다.

1. **`.gitignore` 철저 관리:** `*.tfstate`, `*.tfvars` 파일을 반드시 Git 제외 목록에 추가합니다.
2. **원격 백엔드(Remote Backend) 전환:** 상태 파일을 S3로 옮기고 **S3 서버 측 암호화(SSE, Server-Side Encryption)**를 활성화합니다.
3. **환경 변수 활용:** `.tfvars` 파일조차 불안하다면, OS 환경 변수(`TF_VAR_db_admin_password`)를 통해 값을 주입합니다.

---

Next Step: **AWS S3 Backend(백엔드)를 이용한 상태 파일 원격 저장 및 암호화**

[2026-02-20] 개인 맞춤 설정 확인 완료: 전문 용어 영문 병기(Initial 및 한글 설명), 깃허브 포맷, 강의 교재 형식 및 노출 주의사항 포함.

이 실습을 통해 테라폼의 한계를 명확히 이해하셨을 것입니다. 이제 이 '위험한' 상태 파일을 클라우드로 안전하게 격리하는 단계를 진행하시겠습니까?
