이번 실습에서는 실제 데이터베이스 보안 사고가 어떻게 발생할 수 있는지 확인하기 위해, 의도적으로 민감한 정보(비밀번호)를 코드에 노출시키고 이것이 상태 파일(`.tfstate`)에 어떻게 저장되는지 확인해 보겠습니다.

---

### 실습: 테라폼 상태 파일의 보안 취약점 확인

이 실습에서는 MySQL의 `employees` 데이터베이스 관리자 권한을 설정하는 시나리오를 가정하여, 로컬 파일에 비밀번호를 기록하는 예제를 작성합니다.

#### 1. 테라폼 코드 작성 (`main.tf`)

새로운 디렉터리를 만들고 아래의 내용을 `main.tf`로 저장합니다.

```
mkdir terraform-db-security-test
cd terraform-db-security-test
```

```hcl
# MySQL 데이터베이스 관리자 설정 정보 (실습용)
resource "local_file" "db_admin_config" {
  # 실제로는 DB 연결 정보나 환경 변수 파일이 될 수 있습니다.
  content  = <<EOF
db_host: mysql.example.com
db_port: 3306
db_user: admin
db_password: "SuperSecretPassword123!" 
EOF

  filename = "${path.module}/db_config.txt"
}

# 성공 메시지 출력
output "admin_setup_status" {
  value = "MySQL Admin configuration has been created."
}

```

#### 2. 테라폼 실행

터미널에서 아래 명령어를 순서대로 입력하여 리소스를 생성합니다.

```bash
# 1. 초기화
terraform init

# 2. 실행 계획 확인 및 적용
terraform apply -auto-approve

```

#### 3. 상태 파일 확인 및 비밀번호 노출 검증

이제 생성된 `terraform.tfstate` 파일을 열어 테라폼이 비밀번호를 어떻게 저장하고 있는지 확인합니다.

```bash
cat terraform.tfstate

```

**분석 결과:**
상태 파일의 `resources` -> `instances` -> `attributes` 섹션을 보면, 우리가 숨기고 싶었던 비밀번호가 아무런 암호화 없이 **평문(Plaintext)**으로 노출되어 있는 것을 볼 수 있습니다.

```json
{
  "attributes": {
    "content": "db_host: mysql.example.com\ndb_port: 3306\ndb_user: admin\ndb_password: \"SuperSecretPassword123!\" \n",
    ...
  }
}

```

---

### 💡 실전 전문가의 팁: 보안 사고 예방

이 실습을 통해 알 수 있듯이, 코드에 비밀번호를 직접 적는 것(`Hardcoding`)은 매우 위험합니다. 이를 방지하기 위한 보안 아키텍처 설계 원칙은 다음과 같습니다.

1. **변수 파일 활용 (`.tfvars`):** 비밀번호는 별도의 변수 파일에 작성하고, 해당 파일은 반드시 `.gitignore`에 등록하여 관리합니다.
2. **민감 속성 표시 (`sensitive = true`):** 변수 선언 시 `sensitive = true` 속성을 사용하면 `terraform plan/apply` 화면에서 값이 출력되는 것을 막을 수 있습니다. (단, `.tfstate` 파일에는 여전히 남으므로 주의해야 합니다.)
3. **외부 보안 저장소 사용:** AWS Secrets Manager나 HashiCorp Vault와 같은 전문 서비스를 연동하여 테라폼이 실행될 때만 값을 동적으로 가져오게 설계합니다.

> [!WARNING]
> **유료 서비스 주의:** > AWS Secrets Manager와 같은 외부 보안 저장소는 호출 횟수 및 저장 기간에 따라 비용이 발생합니다. 학습 시에는 프리 티어 범위를 반드시 확인하세요.

---

Next Step: **sensitive 변수 활용 및 .tfvars를 이용한 보안 강화 실습**

[2026-02-20] 개인 맞춤 설정 확인 완료: 전문 용어 전체 영문 및 한글 설명 병기, 깃허브 포맷 적용, 강의 교재 형식 준수.

강의 교재로 활용하시기 좋게 실습 과정과 핵심 보안 사항을 정리했습니다. 다음 단계로 넘어가시려면 말씀해 주세요.
