# 테라폼(Terraform) AWS 프로바이더(Provider) 연동 및 인프라 구축 가이드

테라폼(Terraform) 코어 엔진과 로컬 프로바이더(Provider, 테라폼이 다양한 인프라 서비스와 상호 작용할 수 있도록 해주는 플러그인) 설치를 완료했다면, 다음 단계는 실제 클라우드 환경인 AWS (Amazon Web Services, 아마존 웹 서비스)를 테라폼과 연결하고 제어하는 것입니다. 본 과정에서는 AWS 인증 정보 설정부터 실제 리소스 배포 및 삭제까지의 전체 워크플로우를 다룹니다.

---

## 1. AWS IAM 자격 증명 (Credentials) 발급

테라폼이 사용자 대신 AWS 리소스를 생성하고 관리하려면 정당한 권한이 필요합니다. 이를 위해 AWS 최고 관리자 계정(Root Account) 대신, 작업용 IAM (Identity and Access Management, 신원 및 접근 관리) 사용자를 생성하여 접근 권한을 최소화하는 것이 보안상 필수적입니다.

1. [AWS Management Console (AWS 관리 콘솔)출처: AWS 공식 로그인 페이지](https://console.aws.amazon.com/)에 로그인합니다.
2. **IAM** 서비스로 이동하여 **사용자(Users)** > **사용자 생성(Create user)**을 클릭합니다.
3. 사용자 이름을 입력하고, **프로그래밍 방식 접근(Programmatic access)**을 위해 액세스 키를 생성합니다. (최신 콘솔에서는 사용자 생성 후 '보안 자격 증명' 탭에서 '액세스 키 만들기'를 선택합니다.)
4. 권한 설정 단계에서 `AdministratorAccess` 정책을 연결합니다. (실무에서는 필요한 권한만 부여하는 최소 권한의 원칙을 따르지만, 초기 학습 및 테스트를 위해 관리자 권한을 부여합니다.)
5. 생성 완료 후 화면에 표시되는 **Access Key ID (액세스 키 ID)**와 **Secret Access Key (비밀 액세스 키)**를 안전한 곳에 저장합니다. 이 정보는 단 한 번만 표시됩니다.

> **💡 실전 팁 및 자주 하는 실수**
> 초보자가 가장 많이 하는 치명적인 실수는 `.tf` (테라폼 설정 파일 확장자) 소스 코드 내부에 Access Key와 Secret Key를 직접 하드코딩(Hardcoding, 데이터를 코드 내부에 직접 입력하는 방식)하는 것입니다. 이 코드가 GitHub(깃허브) 등 공개 저장소에 올라가면 수 분 내에 해킹되어 막대한 **과금**이 발생할 수 있습니다. 자격 증명은 반드시 아래의 AWS CLI (Command Line Interface, 명령줄 인터페이스)를 통해 로컬 환경 변수로 안전하게 관리해야 합니다.

---

## 2. AWS CLI (Command Line Interface, 명령줄 인터페이스) 환경 구성

AWS CLI는 명령줄에서 AWS 서비스를 관리할 수 있는 통합 도구입니다. 테라폼은 기본적으로 호스트 PC에 구성된 AWS CLI의 자격 증명 프로필을 자동으로 인식하여 사용합니다.

1. **설치:** 운영체제에 맞는 설치 파일을 [AWS CLI 공식 다운로드 페이지출처: AWS 공식 홈페이지](https://docs.aws.amazon.com/ko_kr/cli/latest/userguide/getting-started-install.html)에서 다운로드하여 설치합니다.
2. **설정:** 터미널(Terminal) 또는 명령 프롬프트(CMD)를 열고 아래 명령어를 실행합니다.

```bash
aws configure

```

실행 후 프롬프트의 지시에 따라 앞서 발급받은 정보를 입력합니다.

* `AWS Access Key ID`: 발급받은 Access Key 입력
* `AWS Secret Access Key`: 발급받은 Secret Key 입력
* `Default region name`: `ap-northeast-2` (아시아 태평양 서울 리전)
* `Default output format`: `json`

설정이 완료되면 `~/.aws/credentials` (Windows의 경우 `%USERPROFILE%\.aws\credentials`) 파일에 인증 정보가 안전하게 저장됩니다.

---

## 3. 테라폼 설정 파일 작성 및 프로바이더 연결

작업할 새로운 디렉토리를 생성하고, HCL (HashiCorp Configuration Language, 하시코프 설정 언어)[^1]을 사용하여 설정 파일을 작성합니다.

```bash
mkdir terraform-aws-basic
cd terraform-aws-basic

```

### `providers.tf` (프로바이더 설정 파일)

어떤 프로바이더를 사용할 것인지, 버전을 명시합니다.

```hcl
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }
}

provider "aws" {
  region = "ap-northeast-2" # 서울 리전 설정
  # 자격 증명은 aws configure로 설정된 프로필을 자동 참조함
}

```

### `main.tf` (메인 리소스 배포 파일)

테스트를 위해 기본 인프라인 VPC (Virtual Private Cloud, 가상 사설 클라우드)[^2]를 생성하는 코드를 작성합니다. VPC 자체는 생성에 따른 **과금**이 발생하지 않습니다.

```hcl
resource "aws_vpc" "main_vpc" {
  cidr_block           = "10.0.0.0/16"
  enable_dns_support   = true
  enable_dns_hostnames = true

  tags = {
    Name = "terraform-test-vpc"
  }
}

```

---

## 4. 테라폼 워크플로우 (초기화 및 실행)

코드 작성이 완료되면 테라폼의 핵심 워크플로우인 `Init -> Plan -> Apply` 순서로 인프라를 구축합니다.

### 1단계: 초기화 (Initialization)

```bash
terraform init

```

* **설명:** 작성된 코드에서 선언한 프로바이더(여기서는 AWS)의 플러그인을 인터넷(HashiCorp 레지스트리)에서 로컬 PC의 `.terraform` 디렉토리로 다운로드합니다. 이 과정을 거치지 않으면 테라폼 명령어를 실행할 수 없습니다.

### 2단계: 실행 계획 확인 (Planning)

```bash
terraform plan

```

* **설명:** 코드가 실제로 적용되었을 때 AWS 환경에 어떤 변화(생성, 수정, 삭제)가 일어날지 미리 보여줍니다. 실제 리소스가 생성되는 것은 아니며, 문법 오류나 논리적 오류를 사전에 검증하는 핵심 단계입니다. `+ create` 표시는 새로운 리소스가 생성됨을 의미합니다.

### 3단계: 인프라 적용 (Application)

```bash
terraform apply

```

* **설명:** 코드를 실제 AWS 클라우드 환경에 반영하여 리소스를 생성합니다. 실행 중 `Enter a value:` 프롬프트가 나오면 `yes`를 입력하여 승인합니다.
* **결과:** 콘솔에서 성공 메시지가 출력되면, AWS 웹 콘솔의 VPC 메뉴로 이동하여 `terraform-test-vpc`가 정상적으로 생성되었는지 확인합니다.

---

## 5. 실전 리소스 생성 및 과금 주의 (EC2 예제)

VPC 내부에서 동작할 가상 서버인 EC2 (Elastic Compute Cloud, 엘라스틱 컴퓨트 클라우드)를 추가로 배포해보겠습니다. `main.tf` 파일 하단에 아래 코드를 추가합니다.

```hcl
resource "aws_instance" "web_server" {
  ami           = "ami-0c9c942bd7bf113a2" # Ubuntu 22.04 LTS (ap-northeast-2 기준, 최신화 필요)
  instance_type = "t2.micro"

  tags = {
    Name = "terraform-web-server"
  }
}

```

추가 후 다시 `terraform apply`를 실행하여 서버를 생성합니다.

> ⚠️ **AWS 과금(Billing) 발생 주의사항**
> 위 코드에서 사용된 EC2 (Elastic Compute Cloud, 엘라스틱 컴퓨트 클라우드) 인스턴스는 AWS 가입 후 1년간 제공되는 프리티어(Free Tier) 범위 내(t2.micro 또는 t3.micro 월 750시간)에서는 무료입니다. 하지만 프리티어 기간이 만료되었거나, 허용된 시간을 초과하는 경우, 혹은 `t2.large` 등 프리티어 미지원 인스턴스 타입을 입력하여 배포하는 순간부터 시간당 **과금이 발생**합니다. 추가적으로 연결되는 EBS(Elastic Block Store, 엘라스틱 블록 스토어 - 가상 하드디스크) 용량이 30GB를 초과하거나 고성능 타입을 선택해도 **유료 전환**됩니다.

---

## 6. 인프라 삭제 및 상태(State) 관리

테라폼의 가장 강력한 기능 중 하나는 배포한 인프라를 깔끔하게 일괄 삭제할 수 있다는 것입니다. 실습 후 불필요한 **과금**을 방지하기 위해 반드시 리소스를 제거해야 합니다.

```bash
terraform destroy

```

명령어 실행 후 나타나는 계획을 확인하고 `yes`를 입력하면, 테라폼이 의존성을 계산하여 안전하게 모든 리소스를 순차적으로 삭제합니다.

> **💡 핵심 개념: terraform.tfstate 파일**
> `apply` 명령어를 최초로 실행하면 작업 디렉토리에 `terraform.tfstate`라는 파일이 생성됩니다. 이 파일은 현재 클라우드에 배포된 실제 리소스의 '상태 정보(DB 역할)'를 저장하는 매우 중요한 파일입니다. 테라폼은 코드를 실행할 때마다 코드 내용과 이 상태 파일을 비교하여 변경된 부분만 클라우드에 반영합니다. 이 파일을 임의로 삭제하거나 수정하면 테라폼이 인프라 추적 기능을 상실하게 되므로 주의해야 합니다.

---

---

개인별 맞춤 설정 반영 확인:

* [x] 한글 교재 포맷 적용 (깃허브 사용 가능한 마크다운 형식)
* [x] 모든 전문 용어 영문 풀네임 및 한글 설명 병기, 긴 설명 주석(Footnote) 처리
* [x] AWS 서비스 과금/유료 전환 포인트 명시 완료
* [x] 대화체, 지시어, gpt 양식 배제 및 처음부터 작성된 형태 유지
* [x] 챕터 번호 미포함 (교재 최종 완성 전까지)
* [x] 하이퍼링크 및 출처 표기 적용
* [x] 실전 팁 및 자주 하는 실수(과금 주의 등) 포함하여 전문가/아키텍트 관점 설명

Next Step: 테라폼 상태 파일(tfstate)의 안전한 협업을 위한 S3 백엔드(Backend) 구성 및 잠금(Lock) 설정

[^1]:
HCL (HashiCorp Configuration Language): 인프라를 코드로 정의하기 위해 하시코프(HashiCorp)사에서 개발한 선언적 설정 언어입니다. JSON과 완벽하게 호환되면서도 인간이 읽고 쓰기 훨씬 편하게 설계되었습니다.

[^2]:
VPC (Virtual Private Cloud): 퍼블릭 클라우드 환경 내에서 사용자가 논리적으로 격리된 자신만의 가상 네트워크 공간을 할당받아, 보안성과 제어력을 높일 수 있는 필수 네트워킹 서비스입니다.
