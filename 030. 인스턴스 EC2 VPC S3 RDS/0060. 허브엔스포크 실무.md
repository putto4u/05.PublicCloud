## 글로벌 허브 앤 스포크(Hub-and-Spoke) 아키텍처 설계: 국내 클러스터 구축

글로벌 기업의 인프라 확장성을 고려할 때, **허브 앤 스포크(Hub-and-Spoke)** 모델은 네트워크 관리의 중앙 집중화와 보안 표준화를 위해 필수적입니다. 향후 미국(USA) 및 유럽(EU) 리전과의 연동을 대비하여 설계된 국내(Seoul) 리전의 첫 번째 스포크(Spoke) VPC 구축 실무 과정을 가이드합니다.

---

### 1. 글로벌 확장형 IP 주소 설계 (IP Addressing)

향후 리전 간 **VPC 피어링(VPC Peering)** 또는 **트랜짓 게이트웨이(Transit Gateway)** 연결 시 IP 충돌을 방지하기 위해 중복되지 않는 CIDR(Classless Inter-Domain Routing, 무클래스 간 도메인 간 라우팅) 설계가 선행되어야 합니다.

| 리전 | 용도 | CIDR 블록 | 비고 |
| --- | --- | --- | --- |
| **Seoul (KR)** | **Hub & Spoke** | **10.10.0.0/16** | 현재 구축 대상 |
| USA (East) | Hub & Spoke | 10.20.0.0/16 | 향후 확장 예정 |
| Europe (EU) | Hub & Spoke | 10.30.0.0/16 | 향후 확장 예정 |

#### [실무 예시: 서울 리전 상세 할당]

* **KR-HUB-VPC:** `10.10.0.0/20` (공통 서비스 및 보안 도구)
* **KR-SPOKE-01-VPC:** `10.10.16.0/20` (현재 구축할 첫 번째 클러스터)

---

### 2. 첫 번째 스포크(Spoke) VPC 및 클러스터 구축 절차

허브를 구축하기 전, 실제 서비스가 구동될 스포크 환경을 먼저 구성합니다. AWS CLI(Command Line Interface, 명령 줄 인터페이스)를 기준으로 진행합니다.

#### 단계 1: VPC 생성

```bash
# VPC 생성 (태그 포함)
aws ec2 create-vpc \
    --cidr-block 10.10.16.0/20 \
    --tag-specifications 'ResourceType=vpc,Tags=[{Key=Name,Value=KR-SPOKE-01}]'

```

#### 단계 2: 서브넷(Subnet) 구성

고가용성을 위해 2개의 가용 영역(AZ)에 퍼블릭 및 프라이빗 서브넷을 배치합니다.

```bash
# 가용 영역 A 프라이빗 서브넷 생성
aws ec2 create-subnet \
    --vpc-id <VPC_ID> \
    --cidr-block 10.10.16.0/24 \
    --availability-zone ap-northeast-2a \
    --tag-specifications 'ResourceType=subnet,Tags=[{Key=Name,Value=KR-SPOKE-01-PRI-A}]'

```

---

### 3. 국내 허브(Hub) 네트워크 전환 및 구성

스포크가 준비되면, 이를 중앙에서 통제할 **TGW(Transit Gateway, 트랜짓 게이트웨이)**를 생성하여 허브 구조를 완성합니다.

> **과금 주의:** Transit Gateway는 생성 시 시간당 비용이 발생하며, 데이터 처리량(GB당)에 따라 추가 요금이 부과됩니다.

#### 단계 1: 트랜짓 게이트웨이 생성

```bash
aws ec2 create-transit-gateway \
    --description "Seoul-Central-Hub-TGW" \
    --tag-specifications 'ResourceType=transit-gateway,Tags=[{Key=Name,Value=KR-HUB-TGW}]'

```

#### 단계 2: VPC 연결 (Attachment)

생성한 TGW에 기존 스포크 VPC를 연결합니다.

```bash
aws ec2 create-transit-gateway-vpc-attachment \
    --transit-gateway-id <TGW_ID> \
    --vpc-id <SPOKE_VPC_ID> \
    --subnet-ids <SUBNET_ID_1> <SUBNET_ID_2> \
    --tag-specifications 'ResourceType=transit-gateway-attachment,Tags=[{Key=Name,Value=KR-SPOKE-01-ATTACH}]'

```

---

### 4. 설정 확인 및 라우팅 검증

연결 후에는 반드시 트래픽이 정상적으로 흐르는지 라우팅 테이블을 확인해야 합니다.

1. **TGW 라우트 테이블 확인:**
* TGW 내에 스포크 VPC의 CIDR(`10.10.16.0/20`)이 자동으로 전파(Propagation)되었는지 확인합니다.
* 명령어: `aws ec2 get-transit-gateway-route-table-propagations --transit-gateway-route-table-id <TGW_RT_ID>`


2. **VPC 라우트 테이블 수정:**
* 스포크 VPC 내의 자원들이 다른 스포크나 허브로 통신하려면 라우트 테이블에 TGW 대상 경로를 추가해야 합니다.
* 대상: `10.10.0.0/16` (서울 전체), 타겟: `tgw-xxxxxx`


3. **연결성 테스트 (Reachability Analyzer):**
* AWS 콘솔의 **Reachability Analyzer(연결성 분석기)**를 사용하여 스포크 간 통신 차단 여부를 시뮬레이션합니다.



---

### 주석 (Annotations)

* **CIDR (Classless Inter-Domain Routing, 무클래스 간 도메인 간 라우팅):** IP 주소를 할당하고 라우팅하는 방식의 하나로, 기존의 클래스 체계보다 유연하게 주소 공간을 분할할 수 있습니다.
* **VPC (Virtual Private Cloud, 가상 사설 클라우드):** AWS 클라우드 내에서 논리적으로 격리된 가상 네트워크 섹션입니다.
* **Transit Gateway (TGW, 트랜짓 게이트웨이):** 수천 개의 VPC와 온프레미스 네트워크를 단일 지점을 통해 연결할 수 있게 해주는 중앙 집중식 허브입니다.

---

**Next Step: 글로벌 리전 간 TGW 피어링 및 라우팅 자동화**

미국과 유럽 리전의 IP 설계는 마쳐두었습니다. 다음 단계로 서울 허브와 미국 리전 허브를 연결하는 **TGW Peering(트랜짓 게이트웨이 피어링)** 설정법과 글로벌 라우팅 전파 전략을 다뤄볼까요?
