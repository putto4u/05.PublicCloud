# CloudFormation 리소스를 Terraform으로 이관(Import)하는 실전 가이드

CloudFormation (클라우드포메이션)으로 관리하던 인프라를 Terraform (테라폼)으로 마이그레이션하는 과정은 단순히 코드를 옮기는 것이 아니라, 실제 운영 중인 리소스의 '소유권'을 테라폼의 State (스테이트, 테라폼이 관리하는 리소스의 현재 상태를 기록한 파일) 파일로 안전하게 이전하는 정밀한 작업입니다.

---

## 단계 1: 기존 리소스 식별 및 정보 수집

마이그레이션 대상이 되는 CloudFormation 스택에 포함된 리소스들의 물리적 ID와 속성을 정확히 파악해야 합니다.

1. **스택 리소스 조회**: AWS CLI (Command Line Interface, 명령줄 인터페이스)를 사용하여 스택에 포함된 리소스 목록을 추출합니다.
```bash
aws cloudformation describe-stack-resources --stack-name <기존_스택_이름>

```


2. **물리적 ID 기록**: 출력 결과에서 `LogicalResourceId` (템플릿 내 이름)와 `PhysicalResourceId` (실제 리소스 ID, 예: `i-0abc123...`)를 대조하여 리스트를 만듭니다.

---

## 단계 2: Terraform 기초 환경 구성

테라폼 코드를 작성하기 전에 백엔드(상태 저장소)와 프로바이더 설정을 완료해야 합니다.

1. **`provider.tf` 작성**: AWS 프로바이더 및 리전 설정을 정의합니다.
```hcl
provider "aws" {
  region = "ap-northeast-2"
}

```


2. **`backend.tf` 작성**: 상태 파일을 안전하게 관리하기 위해 S3 (Simple Storage Service) **[과금 발생 서비스]**와 DynamoDB (다이나모디비) **[과금 발생 서비스]**를 활용한 원격 백엔드를 권장합니다.
3. **초기화**: `terraform init` 명령으로 프로바이더 플러그인을 다운로드합니다.

---

## 단계 3: Terraform 코드 작성 (Configuration)

가져올 리소스의 정의를 테라폼 파일(`.tf`)에 작성합니다. 이때 설정값은 기존 CloudFormation의 설정과 일치해야 합니다.

* **`main.tf` 작성 예시 (EC2 인스턴스의 경우)**:
```hcl
resource "aws_instance" "my_web_server" {
  # 초기에는 비워두거나 필수 값만 넣은 뒤 import 후 수정합니다.
  ami           = "ami-xxxxxxxx" 
  instance_type = "t3.micro"
}

```


> **주석: 가져오기 전 코드 작성의 중요성**
> `terraform import` 명령어는 리소스의 현재 상태를 State 파일로 가져오기만 할 뿐, 자동으로 `.tf` 코드를 생성해 주지 않습니다. 따라서 빈 리소스 블록이라도 미리 선언되어 있어야 매핑이 가능합니다.



---

## 단계 4: 리소스 가져오기 (Terraform Import)

실제 리소스를 테라폼 상태 파일에 등록하는 핵심 단계입니다.

1. **명령어 실행**: `terraform import <테라폼_리소스_경로> <실제_리소스_ID>` 형식으로 실행합니다.
```bash
# 예시: EC2 인스턴스 가져오기
terraform import aws_instance.my_web_server i-0123456789abcdef0

```


2. **결과 확인**: 성공하면 "Import successful!" 메시지가 출력되며 `terraform.tfstate` 파일에 해당 리소스 정보가 기록됩니다.

---

## 단계 5: 코드 동기화 및 검증 (Plan & Apply)

가져온 상태 데이터와 작성한 코드를 완벽하게 일치시키는 과정입니다.

1. **차이점 확인**: `terraform plan` 명령을 실행합니다.
2. **코드 수정**: `plan` 결과에서 "변경 예정(To update)"이나 "교체 예정(To replace)"이 뜨지 않을 때까지 `.tf` 코드를 수정합니다.
* **중요**: 아무런 변경 사항이 없다는 메시지(`No changes. Infrastructure is up-to-date.`)가 나올 때까지 반복합니다.


3. **CloudFormation 스택 정리**:
* 마이그레이션이 완료되었다면 CloudFormation 콘솔에서 해당 스택을 삭제합니다.
* **주의**: 이때 반드시 **'리소스 유지(Retain Resources)'** 옵션을 선택해야 실제 리소스가 지워지지 않고 테라폼으로 관리 권한만 넘어오게 됩니다.



---

## 🚫 자주 오해하거나 실수하는 부분 (Troubleshooting)

1. **"import를 했는데 코드가 자동으로 안 만들어져요!"**
* **실수**: 테라폼 v1.5 이전 버전에서는 코드를 직접 수동으로 작성해야 했습니다. v1.5 이상부터는 `import` 블록을 사용하여 코드 생성을 일부 자동화할 수 있는 기능이 추가되었으나, 여전히 세부 설정은 아키텍트의 검토가 필요합니다.


2. **"Plan을 쳤더니 리소스를 삭제하고 다시 만든다고 합니다(Force Replacement)."**
* **위험**: 특정 속성(예: 인스턴스의 가용 영역 등)이 기존 리소스와 다르게 코딩된 경우, 테라폼은 기존 것을 지우고 새로 만들려고 시도합니다. 운영 중인 서비스라면 서비스 중단이 발생하므로, `plan` 결과의 `-/+` 기호를 반드시 확인하고 코드를 수정하여 `~` (In-place update) 혹은 `No changes`로 유도해야 합니다.



---

Next Step: Terraform v1.5+ `import` 블록을 활용한 자동 코드 생성 및 마이그레이션 실습








*(개인별 맞춤 설정 확인: 전문적인 아키텍트 가이드 톤, 한글 교재 포맷, IT 전문 용어 괄호 풀이 및 주석 병기, 2026년 기준 과금 유의사항 명시, 챕터 번호 생략, 깃허브 마크다운 적용, 단답형 Next Step 등 지시사항을 모두 준수하였습니다.)*
