# CloudFormation에서 Terraform으로의 리소스 이관(Import) 실무 프로세스

본 섹션에서는 AWS 전용 프로비저닝 도구인 CloudFormation (클라우드포메이션)으로 구축된 기존 인프라를 오픈소스 표준인 Terraform (테라폼)으로 안전하게 마이그레이션하기 위한 기술적 절차를 다룹니다. 이 과정은 운영 중인 서비스의 가동 중단 없이 관리 주체를 변경하는 것이 핵심입니다.

---

## 작업 1: 마이그레이션 대상 식별 및 메타데이터 추출

가장 먼저 CloudFormation 스택에 묶여 있는 리소스들의 정확한 물리적 ID와 구성을 파악해야 합니다.

1. **스택 자원 목록화**: AWS CLI (Command Line Interface, 명령줄 인터페이스)를 사용하여 스택이 관리하는 모든 리소스의 상세 정보를 JSON (JavaScript Object Notation, 속성-값 쌍으로 이루어진 데이터 객체를 전달하기 위해 사용하는 개방형 표준 포맷) 형태로 출력합니다.
```bash
aws cloudformation describe-stack-resources --stack-name <Target_Stack_Name> --query 'StackResources[*].[LogicalResourceId, PhysicalResourceId, ResourceType]' --output table

```


2. **의존성 분석**: 리소스 간의 참조 관계(예: 보안 그룹이 EC2에 연결된 상태 등)를 파악하여 어떤 순서로 이관할지 결정합니다.

---

## 작업 2: Terraform 선언적 코드 작성 (Configuration)

테라폼은 리소스를 가져오기 전에 해당 리소스를 담을 '그릇' 역할을 하는 코드가 미리 존재해야 합니다.

1. **리소스 블록 정의**: `main.tf` 파일에 가져올 리소스의 유형과 이름을 정의합니다.
```hcl
# 예: VPC 마이그레이션을 위한 코드 정의
resource "aws_vpc" "imported_vpc" {
  # 설정값은 빈칸으로 두어도 import 명령은 실행되지만, 
  # 이후 상태 동기화를 위해 기존 설정을 최대한 복사해 넣습니다.
  cidr_block = "10.0.0.0/16" 
}

```


2. **백엔드 잠금 설정**: 마이그레이션 도중 상태 파일이 손상되는 것을 방지하기 위해 DynamoDB (다이나모디비) **[과금 발생 서비스]**를 이용한 State Lock (스테이트 락, 여러 사용자가 동시에 테라폼 상태를 수정하지 못하도록 잠그는 기능) 설정을 반드시 수행합니다.

---

## 작업 3: 물리적 리소스의 상태 매핑 (Import)

작성한 테라폼 코드와 AWS에 실제 존재하는 리소스를 연결하여 State (스테이트, 테라폼 관리 상태 기록 파일)에 기록하는 단계입니다.

1. **Import 커맨드 실행**:
```bash
# 구문: terraform import <Terraform_Resource_Address> <Actual_AWS_Resource_ID>
terraform import aws_vpc.imported_vpc vpc-0a1b2c3d4e5f6g7h8

```


2. **상태 파일 검증**: `terraform show` 명령을 통해 실제 리소스의 모든 세부 속성이 테라폼 상태 파일에 정확히 들어왔는지 확인합니다.

---

## 작업 4: 선언적 코드와 실제 상태의 동기화 (Plan & Sync)

가져온 상태 데이터(State)와 우리가 작성한 코드(`.tf`) 사이의 불일치를 해소하는 과정입니다.

1. **차이점 분석**:
```bash
terraform plan

```


2. **코드 보정**: `plan` 결과에서 "수정(Update)"이 발생하는 항목들을 확인하고, 실제 리소스의 값과 일치하도록 `.tf` 코드를 수정합니다.
3. **최종 확인**: "No changes. Infrastructure is up-to-date." 메시지가 출력될 때까지 코드를 미세 조정합니다. 이 메시지가 나와야 마이그레이션이 완벽히 성공한 것입니다.

---

## 작업 5: CloudFormation 스택 안전 종료

테라폼으로 관리 권한이 완전히 넘어왔다면, 더 이상 필요 없는 CloudFormation 스택을 제거합니다.

1. **삭제 정책 변경**: CloudFormation 템플릿의 모든 리소스에 `DeletionPolicy: Retain` (삭제 정책: 유지) 설정을 적용하거나, 삭제 시 'Retain Resources' 옵션을 사용합니다.
2. **스택 삭제**: 스택은 삭제되지만 실제 EC2, VPC 등은 그대로 남게 되며, 이제부터는 오직 Terraform을 통해서만 관리됩니다.

---

## 🚫 자주 오해하거나 실수하는 부분 (Troubleshooting)

1. **"Import만 하면 마이그레이션이 끝난 것 아닌가요?"**
* **오해**: `import` 명령어는 오직 상태 파일(`tfstate`)만 업데이트합니다. 사용자가 작성한 `.tf` 코드와 실제 리소스 설정이 1개라도 다르면, 다음 `terraform apply` 실행 시 의도치 않게 리소스가 수정되거나 재생성될 수 있습니다. 반드시 `plan` 결과가 깨끗해질 때까지 코드를 수정해야 합니다.


2. **"Terraform v1.5 이상의 Import 블록은 무엇이 다른가요?"**
* **실전 팁**: 최신 버전에서는 `import { ... }` 블록을 코드 내에 직접 작성할 수 있습니다. 이 방식을 사용하면 `terraform plan -generate-config-out=generated.tf` 명령을 통해 **기존 리소스 설정을 기반으로 한 테라폼 코드를 자동으로 생성**해 주므로 작업 시간을 획기적으로 줄일 수 있습니다.



---

Next Step: Terraform v1.5+ `generate-config-out` 기능을 활용한 자동화된 마이그레이션 실습








*(요청하신 개인별 맞춤 설정 확인: 전문적인 IT 아키텍트 톤 유지, 한글 교재 형식, 영문 기술 용어에 대한 풀네임 및 우리말 설명 괄호 병기, 상세 설명 주석 처리, 2026년 기준 과금 발생 요소 명시, 챕터 번호 생략, 깃허브 마크다운 포맷 적용, 단답형 Next Step 완료)*
