<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IaC 마이그레이션 전략: CloudFormation to Terraform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8fafc; }
        .code-block { background-color: #1e293b; color: #f8fafc; border-radius: 0.5rem; padding: 1.5rem; overflow-x: auto; font-family: 'Courier New', Courier, monospace; }
        .accent-border { border-left: 4px solid #3b82f6; }
        .billing-tag { background-color: #fef2f2; color: #dc2626; border: 1px solid #fecaca; padding: 0.1rem 0.4rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: bold; }
        .expert-note { background-color: #eff6ff; border: 1px solid #dbeafe; padding: 1rem; border-radius: 0.5rem; }
    </style>
</head>
<body class="text-slate-800 leading-relaxed">

    <!-- Header -->
    <header class="bg-slate-900 text-white py-12 px-6 shadow-lg">
        <div class="max-w-5xl mx-auto text-center">
            <h1 class="text-4xl font-bold mb-4">CloudFormation 리소스를 Terraform으로 이관(Import)하는 실무 프로세스</h1>
            <p class="text-slate-400 text-lg">운영 중인 인프라의 가동 중단 없는 관리 주체 전환 및 IaC 고도화 전략</p>
        </div>
    </header>

    <main class="max-w-5xl mx-auto py-12 px-6">
        
        <!-- Introduction -->
        <section class="mb-16">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold">01</div>
                <h2 class="text-2xl font-bold">마이그레이션 아키텍처 개요</h2>
            </div>
            <p class="mb-6">
                본 가이드는 AWS 전용 프로비저닝 도구인 <strong>CloudFormation (클라우드포메이션, AWS 리소스를 템플릿 파일로 모델링하고 자동 배포해 주는 코드형 인프라 서비스)</strong>으로 구축된 기존 인프라를 오픈소스 표준인 <strong>Terraform (테라폼, 해시코프에서 개발한 오픈소스 코드형 인프라 관리 도구)</strong>으로 안전하게 마이그레이션하기 위한 기술적 절차를 다룹니다.
            </p>
            <div class="bg-white p-8 rounded-xl shadow-sm border border-slate-200 text-center">
                <p class="text-slate-500 italic mb-4">[CloudFormation 스택에서 Terraform State 파일로 리소스 소유권이 이전되는 워크플로우 다이어그램]</p>
                <div class="flex justify-center gap-8">
                    <div class="p-4 bg-orange-50 rounded-lg border border-orange-200 w-40 text-sm font-bold">AWS CloudFormation</div>
                    <div class="flex items-center">➔</div>
                    <div class="p-4 bg-purple-50 rounded-lg border border-purple-200 w-40 text-sm font-bold">Terraform State</div>
                </div>
            </div>
        </section>

        <!-- Step 1 -->
        <section class="mb-16">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold">02</div>
                <h2 class="text-2xl font-bold">작업 1: 마이그레이션 대상 식별 및 메타데이터 추출</h2>
            </div>
            <p class="mb-4">먼저 마이그레이션 대상이 되는 <strong>Stack (스택, CloudFormation에서 하나의 단위로 관리되는 리소스 집합)</strong> 내의 물리적 리소스 ID를 정확히 추출해야 합니다.</p>
            <div class="code-block mb-4">
                # AWS CLI를 사용하여 스택 리소스 목록 및 물리적 ID 추출<br>
                aws cloudformation describe-stack-resources --stack-name "MyProjectStack" --query 'StackResources[*].[LogicalResourceId, PhysicalResourceId, ResourceType]' --output table
            </div>
            <div class="expert-note text-sm">
                <strong>전문가 주석:</strong> 추출된 <strong>PhysicalResourceId (물리적 리소스 식별자, AWS 내에서 해당 자원을 고유하게 구분하는 ID)</strong>는 이후 테라폼 <code>import</code> 명령의 인자값으로 사용되므로 정확히 기록해 두어야 합니다.
            </div>
        </section>

        <!-- Step 2 -->
        <section class="mb-16">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold">03</div>
                <h2 class="text-2xl font-bold">작업 2: Terraform 선언적 코드 작성 (Configuration)</h2>
            </div>
            <p class="mb-4">테라폼은 리소스를 가져오기 전에 이를 선언하는 코드가 미리 존재해야 합니다. <strong>HCL (HashiCorp Configuration Language, 테라폼 전용 구성 언어)</strong>을 사용하여 뼈대 코드를 작성합니다.</p>
            <div class="code-block mb-4 text-sm">
<pre>
# main.tf 구성 예시
resource "aws_vpc" "imported_vpc" {
  # 설정값은 빈칸으로 두어도 되지만, 가져온 후 plan 시 차이를 줄이기 위해
  # 기존 CloudFormation의 설정을 미리 기입하는 것을 권장합니다.
  cidr_block = "10.0.0.0/16"
  tags = {
    Name = "Migrated-VPC"
  }
}
</pre>
            </div>
            <p class="text-sm flex items-center gap-2 mb-4">
                <span class="billing-tag">과금 발생 서비스</span> 
                <strong>S3 (Simple Storage Service, 객체 스토리지 서비스)</strong> 및 
                <strong>DynamoDB (다이나모디비, NoSQL 데이터베이스)</strong>를 백엔드로 사용할 경우 상태 파일 저장 및 락킹 비용이 발생합니다.
            </p>
        </section>

        <!-- Step 3 & 4 (Combined for Flow) -->
        <section class="mb-16">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold">04</div>
                <h2 class="text-2xl font-bold">작업 3 & 4: 상태 매핑(Import) 및 동기화(Sync)</h2>
            </div>
            <p class="mb-4">실제 리소스를 테라폼 <strong>State (스테이트, 테라폼이 관리하는 리소스의 현재 상태를 기록한 파일)</strong>에 등록하고 코드와 일치시킵니다.</p>
            
            <h3 class="font-bold text-lg mb-2">3.1 레거시 방식 (직접 Import)</h3>
            <div class="code-block mb-6">
                # 구문: terraform import [Terraform_리소스_경로] [실제_AWS_리소스_ID]<br>
                terraform import aws_vpc.imported_vpc vpc-0a1b2c3d4e5f6g7h8
            </div>

            <h3 class="font-bold text-lg mb-2">3.2 최신 방식 (Terraform v1.5+ Import 블록)</h3>
            <p class="text-sm mb-4">최신 버전에서는 코드로 <code>import</code>를 제어하고 설정을 자동 생성할 수 있습니다.</p>
            <div class="code-block mb-4 text-sm">
<pre>
# import.tf 작성
import {
  to = aws_vpc.imported_vpc
  id = "vpc-0a1b2c3d4e5f6g7h8"
}

# 설정 자동 생성 명령 실행
terraform plan -generate-config-out=generated_vpc.tf
</pre>
            </div>
            <div class="accent-border p-4 bg-slate-50 mb-6">
                <strong>작업 4 (Sync):</strong> 위 명령 수행 후 <code>terraform plan</code>을 실행하여 "No changes"가 나올 때까지 코드를 수정합니다. 만약 <code>-/+ replace</code> (삭제 후 재생성) 메시지가 뜬다면 운영 중인 서비스가 중단될 수 있으므로 절대 주의해야 합니다.
            </div>
        </section>

        <!-- Step 5 -->
        <section class="mb-16">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold">05</div>
                <h2 class="text-2xl font-bold">작업 5: CloudFormation 스택 안전 종료</h2>
            </div>
            <p class="mb-4">마이그레이션이 완료되었다면 관리 주체가 중복되지 않도록 기존 스택을 제거해야 합니다.</p>
            <div class="expert-note border-yellow-200 bg-yellow-50">
                <h4 class="font-bold text-yellow-800 mb-2">⚠️ 주의: 리소스 유지 정책 적용</h4>
                <p class="text-sm text-yellow-700">
                    단순히 스택을 삭제하면 연결된 실제 리소스도 함께 삭제됩니다. 템플릿의 각 리소스에 <strong>DeletionPolicy: Retain (삭제 정책: 유지, 스택 삭제 시에도 실제 자원은 삭제하지 않고 보존함)</strong> 설정을 반드시 적용한 후 스택을 삭제해야 합니다.
                </p>
            </div>
        </section>

        <!-- Troubleshooting -->
        <section class="mb-16">
            <h2 class="text-2xl font-bold mb-6 border-b-2 border-slate-200 pb-2">🚫 자주 오해하거나 실수하는 부분 (Troubleshooting)</h2>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="p-6 bg-white rounded-xl shadow-sm border border-slate-200">
                    <h4 class="font-bold mb-2">Q. Import를 하면 .tf 코드가 생기나요?</h4>
                    <p class="text-sm text-slate-600">
                        <strong>오해:</strong> 아니오. 레거시 <code>import</code> 명령은 오직 상태 파일(State)만 업데이트합니다. 최신 버전의 <code>-generate-config-out</code> 옵션을 사용하지 않는 한, 코드는 아키텍트가 직접 작성해야 합니다.
                    </p>
                </div>
                <div class="p-6 bg-white rounded-xl shadow-sm border border-slate-200">
                    <h4 class="font-bold mb-2">Q. 왜 Plan에서 자꾸 교체(Replace)가 뜨나요?</h4>
                    <p class="text-sm text-slate-600">
                        <strong>실수:</strong> 기존 리소스의 특정 속성(예: 가용 영역, 이름 태그 등)이 테라폼 코드와 일치하지 않기 때문입니다. 운영 환경에서는 심각한 장애를 초래하므로 <code>plan</code> 결과의 <code>-/+</code> 기호를 철저히 분석해야 합니다.
                    </p>
                </div>
            </div>
        </section>

        <!-- Footer Info -->
        <footer class="mt-20 pt-8 border-t border-slate-200 text-slate-500 text-sm">
            <div class="flex justify-between items-center">
                <p>© 2026 IP Vocational Training Expert Course - IaC Migration Series</p>
                <div class="flex gap-4">
                    <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudformation_stack" class="hover:text-blue-600 underline">AWS Provider Docs</a>
                    <a href="https://developer.hashicorp.com/terraform/language/import" class="hover:text-blue-600 underline">Terraform Import Guide</a>
                </div>
            </div>
        </footer>
    </main>

    <div class="fixed bottom-8 right-8 bg-blue-600 text-white px-6 py-3 rounded-full shadow-2xl font-bold cursor-default">
        Next Step: Terraform v1.5+ generate-config-out 기능을 활용한 자동화된 마이그레이션 실습
    </div>

</body>
</html>
