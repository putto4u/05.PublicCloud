# 최상위 terragrunt.hcl
## 버전 V1
```
# 상위 terragrunt.hcl의 일부

# 1. AWS 및 K8s 프로바이더 규칙 정의
generate "provider" {
  path      = "provider.tf"
  if_exists = "overwrite_terragrunt"
  contents  = <<EOF
provider "aws" {
  region = "ap-northeast-2" # 모든 모듈이 서울 리전을 쓰도록 강제
}
EOF
}

# 2. 모든 모듈이 사용할 공통 태그
inputs = {
  common_tags = {
    Project = "IP-Expert-Training"
    ManagedBy = "Terragrunt"
  }
}
```
## 버전 V2
```
# ---------------------------------------------------------------------------------------------------------------------
# ROOT TERRAGRUNT CONFIGURATION
# ---------------------------------------------------------------------------------------------------------------------

locals {
  # 공통 변수
  aws_region   = "ap-northeast-2"
  project_name = "ip-expert-infra"

  # 미래 K8s 설정을 위한 변수 (현재는 로컬 환경이나 더미 경로로 지정 가능)
  # Kubeconfig (쿠베컨피그: 쿠버네티스 접속 설정 파일)
  kubeconfig_path = "~/.kube/config" 
}

# 1. 원격 상태 저장소 (S3 & DynamoDB)
# 과금 주의: S3 저장 및 DynamoDB Lock 테이블 사용량에 따른 비용 발생
remote_state {
  backend = "s3"
  generate = {
    path      = "backend.tf"
    if_exists = "overwrite_terragrunt"
  }
  config = {
    bucket         = "${local.project_name}-terraform-state"
    key            = "${path_relative_to_include()}/terraform.tfstate"
    region         = local.aws_region
    encrypt        = true
    dynamodb_table = "${local.project_name}-lock-table"
  }
}

# 2. AWS 프로바이더 생성
generate "aws_provider" {
  path      = "provider_aws.tf"
  if_exists = "overwrite_terragrunt"
  contents  = <<EOF
provider "aws" {
  region = "${local.aws_region}"
}
EOF
}

# 3. 미래를 위한 내부 K8s 프로바이더 생성 (선택적 활성화 가능)
generate "k8s_provider" {
  path      = "provider_k8s.tf"
  if_exists = "overwrite_terragrunt"
  contents  = <<EOF
provider "kubernetes" {
  # 내부 k8s 연결 시 사용할 설정
  config_path = "${local.kubeconfig_path}"
}

provider "helm" {
  kubernetes {
    config_path = "${local.kubeconfig_path}"
  }
}
EOF
}

# 4. 모든 하위 모듈에 전달할 공통 변수
inputs = {
  aws_region      = local.aws_region
  project_name    = local.project_name
  kubeconfig_path = local.kubeconfig_path
}
```



## 버전 V3
```
# ---------------------------------------------------------------------------------------------------------------------
# GLOBAL MULTI-REGION TERRAGRUNT CONFIGURATION
# ---------------------------------------------------------------------------------------------------------------------

locals {
  # 1. 대륙별 대표 리전 변수 정의
  regions = {
    asia   = "ap-northeast-2" # 서울
    us     = "us-east-1"      # 버지니아 북부
    europe = "eu-central-1"   # 프랑크푸르트
  }

  project_name = "ip-global-service"
  
  # 내부 K8s 접속 정보
  kubeconfig_path = "~/.kube/config"
}

# 2. 원격 상태 저장소 (서울 리전을 중앙 저장소로 사용)
# 과금 주의: 리전 간 데이터 전송(Data Transfer) 시 추가 비용이 발생할 수 있습니다.
remote_state {
  backend = "s3"
  generate = {
    path      = "backend.tf"
    if_exists = "overwrite_terragrunt"
  }
  config = {
    bucket         = "${local.project_name}-terraform-state"
    key            = "${path_relative_to_include()}/terraform.tfstate"
    region         = local.regions.asia
    encrypt        = true
    dynamodb_table = "${local.project_name}-lock-table"
  }
}

# 3. AWS 프로바이더 자동 생성 (별칭을 이용한 멀티 리전 대응)
generate "aws_provider" {
  path      = "provider_aws.tf"
  if_exists = "overwrite_terragrunt"
  contents  = <<EOF
# 기본 리전 (서울)
provider "aws" {
  region = "${local.regions.asia}"
}

# 미국 동부 리전 (별칭: us_east_1)
provider "aws" {
  alias  = "us_east_1"
  region = "${local.regions.us}"
}

# 유럽 중앙 리전 (별칭: eu_central_1)
provider "aws" {
  alias  = "eu_central_1"
  region = "${local.regions.europe}"
}
EOF
}

# 4. 내부 K8s 및 Helm 프로바이더 생성
generate "k8s_provider" {
  path      = "provider_k8s.tf"
  if_exists = "overwrite_terragrunt"
  contents  = <<EOF
provider "kubernetes" {
  config_path = "${local.kubeconfig_path}"
}

provider "helm" {
  kubernetes {
    config_path = "${local.kubeconfig_path}"
  }
}
EOF
}

# 5. 모든 하위 모듈에 전달할 글로벌 입력값
inputs = {
  global_regions  = local.regions
  project_name    = local.project_name
  kubeconfig_path = local.kubeconfig_path
}

```

## 버전 V4
```
# ---------------------------------------------------------------------------------------------------------------------
# GLOBAL & MULTI-CLOUD INTEGRATED CONFIGURATION
# ---------------------------------------------------------------------------------------------------------------------

locals {
  # 1. 글로벌 리전 정의 (Asia, US, Europe)
  # 서비스 확장성을 위해 대륙별 거점 리전을 미리 상수로 관리합니다.
  regions = {
    asia   = "ap-northeast-2" # 서울 (메인 저장소 및 아시아 거점)
    us     = "us-east-1"      # 버지니아 북부 (미주 거점)
    europe = "eu-central-1"   # 프랑크푸르트 (유럽 거점)
  }

  project_name = "ip-global-infra"

  # 2. 내부 K8s 접속 정보 (미래 확장용)
  # Kubeconfig(쿠베컨피그) 파일의 기본 경로를 지정합니다.
  kubeconfig_path = "~/.kube/config"
}

# 3. 원격 상태 저장소 설정 (S3 & DynamoDB)
# 과금 주의: S3 저장 및 DynamoDB Lock 테이블 사용량에 따른 비용 발생 (프리티어 확인 권장)
remote_state {
  backend = "s3"
  generate = {
    path      = "backend.tf"
    if_exists = "overwrite_terragrunt"
  }
  config = {
    bucket         = "${local.project_name}-terraform-state"
    key            = "${path_relative_to_include()}/terraform.tfstate"
    region         = local.regions.asia
    encrypt        = true
    dynamodb_table = "${local.project_name}-lock-table"

    # [강제 삭제 설정] 
    # true 설정 시, 버킷 내부의 상태 파일이 있어도 destroy 시 강제로 삭제합니다.
    s3_bucket_properties = {
      force_destroy = true
################# S3 강제 삭제 ######################
    }
  }
}

# 4. AWS 프로바이더 자동 생성 (Multi-Region Alias 포함)
# 각 하위 모듈에서 특정 리전을 지정하여 사용할 수 있도록 별칭(alias)을 부여합니다.
generate "aws_provider" {
  path      = "provider_aws.tf"
  if_exists = "overwrite_terragrunt"
  contents  = <<EOF
provider "aws" {
  region = "${local.regions.asia}"
}

provider "aws" {
  alias  = "us_east_1"
  region = "${local.regions.us}"
}

provider "aws" {
  alias  = "eu_central_1"
  region = "${local.regions.europe}"
}
EOF
}

# 5. Kubernetes & Helm 프로바이더 자동 생성
# 내부 K8s 환경으로 확장 시 이 설정을 통해 즉시 리소스 제어가 가능합니다.
generate "k8s_provider" {
  path      = "provider_k8s.tf"
  if_exists = "overwrite_terragrunt"
  contents  = <<EOF
provider "kubernetes" {
  config_path = "${local.kubeconfig_path}"
}

provider "helm" {
  kubernetes {
    config_path = "${local.kubeconfig_path}"
  }
}
EOF
}

# 6. 하위 모듈 공통 입력값 (Global Inputs)
inputs = {
  global_regions  = local.regions
  project_name    = local.project_name
  kubeconfig_path = local.kubeconfig_path
}
```


버전 V5
```
# ---------------------------------------------------------------------------------------------------------------------
# GLOBAL & MULTI-CLOUD INTEGRATED CONFIGURATION (ENTERPRISE GRADE)
# ---------------------------------------------------------------------------------------------------------------------

locals {
  regions = {
    asia   = "ap-northeast-2"
    us     = "us-east-1"
    europe = "eu-central-1"
  }
  project_name    = "ip-global-infra"
  kubeconfig_path = "~/.kube/config"

  # [추가] 글로벌 라우팅을 위한 기본 도메인 선언
  base_domain = "ipexpert.com" 
}

# 1. 버전 제약 (작업자 간 환경 통일)
terraform_version_constraint  = ">= 1.5.0"
terragrunt_version_constraint = ">= 0.50.0"

# 2. 원격 상태 저장소 (S3 버저닝 활성화)
remote_state {
  backend = "s3"
  generate = {
    path      = "backend.tf"
    if_exists = "overwrite_terragrunt"
  }
  config = {
    bucket         = "${local.project_name}-terraform-state"
    key            = "${path_relative_to_include()}/terraform.tfstate"
    region         = local.regions.asia
    encrypt        = true
    dynamodb_table = "${local.project_name}-lock-table"
    
    s3_bucket_properties = {
      force_destroy = true
      versioning    = { enabled = true } # [추가] 상태 파일 덮어쓰기 복구용 버저닝 강제 활성화
    }
  }
}

# 3. AWS 프로바이더 자동 생성 (Default Tags 적용)
generate "aws_provider" {
  path      = "provider_aws.tf"
  if_exists = "overwrite_terragrunt"
  contents  = <<EOF
provider "aws" {
  region = "${local.regions.asia}"
  default_tags {
    tags = {
      Project     = "${local.project_name}"
      ManagedBy   = "Terragrunt"
      Environment = "Global-Training"
    }
  }
}

provider "aws" {
  alias  = "us_east_1"
  region = "${local.regions.us}"
  default_tags {
    tags = {
      Project     = "${local.project_name}"
      ManagedBy   = "Terragrunt"
      Environment = "Global-Training"
    }
  }
}

provider "aws" {
  alias  = "eu_central_1"
  region = "${local.regions.europe}"
  default_tags {
    tags = {
      Project     = "${local.project_name}"
      ManagedBy   = "Terragrunt"
      Environment = "Global-Training"
    }
  }
}
EOF
}

# 4. K8s 프로바이더 생성 (유지)
generate "k8s_provider" {
  path      = "provider_k8s.tf"
  if_exists = "overwrite_terragrunt"
  contents  = <<EOF
provider "kubernetes" {
  config_path = "${local.kubeconfig_path}"
}
provider "helm" {
  kubernetes {
    config_path = "${local.kubeconfig_path}"
  }
}
EOF
}

# 5. 하위 모듈 입력값 (Global Inputs)
inputs = {
  global_regions  = local.regions
  project_name    = local.project_name
  kubeconfig_path = local.kubeconfig_path
  base_domain     = local.base_domain
}
```



## 최종 수정 hcl
```
# ---------------------------------------------------------------------------------------------------------------------
# GLOBAL & MULTI-CLOUD INTEGRATED CONFIGURATION (ENTERPRISE GRADE)
# ---------------------------------------------------------------------------------------------------------------------

locals {
  regions = {
    asia   = "ap-northeast-2"
    us     = "us-east-1"
    europe = "eu-central-1"
  }
  project_name    = "megaiac"
  kubeconfig_path = "~/.kube/config"

  # [추가] 글로벌 라우팅을 위한 기본 도메인 선언
  base_domain = "megaiac.com"
}

# 1. 버전 제약 (작업자 간 환경 통일)
terraform_version_constraint  = ">= 1.5.0"
terragrunt_version_constraint = ">= 0.50.0"

# 2. 원격 상태 저장소 (S3 버저닝 활성화)
remote_state {
  backend = "s3"
  generate = {
    path      = "backend.tf"
    if_exists = "overwrite_terragrunt"
  }
  config = {
    bucket         = "${local.project_name}-terraform-state"
    key            = "${path_relative_to_include()}/terraform.tfstate"
    region         = local.regions.asia
    encrypt        = true
    dynamodb_table = "${local.project_name}-lock-table"

    s3_bucket_properties = {
      force_destroy = true
      versioning    = { enabled = true } # [추가] 상태 파일 덮어쓰기 복구용 버저닝 강제 활성화
    }
  }
}

# 3. AWS 프로바이더 자동 생성 (Default Tags 적용)
generate "aws_provider" {
  path      = "provider_aws.tf"
  if_exists = "overwrite_terragrunt"
  contents  = <<EOF
provider "aws" {
  region = "${local.regions.asia}"
  default_tags {
    tags = {
      Project     = "${local.project_name}"
      ManagedBy   = "Terragrunt"
      Environment = "Global-Training"
    }
  }
}

provider "aws" {
  alias  = "us_east_1"
  region = "${local.regions.us}"
  default_tags {
    tags = {
      Project     = "${local.project_name}"
      ManagedBy   = "Terragrunt"
      Environment = "Global-Training"
    }
  }
}

provider "aws" {
  alias  = "eu_central_1"
  region = "${local.regions.europe}"
  default_tags {
    tags = {
      Project     = "${local.project_name}"
      ManagedBy   = "Terragrunt"
      Environment = "Global-Training"
    }
  }
}
EOF
}

# 4. K8s 프로바이더 생성 (유지)
generate "k8s_provider" {
  path      = "provider_k8s.tf"
  if_exists = "overwrite_terragrunt"
  contents  = <<EOF
provider "kubernetes" {
  config_path = "${local.kubeconfig_path}"
}
provider "helm" {
  kubernetes {
    config_path = "${local.kubeconfig_path}"
  }
}
EOF
}

# 5. 하위 모듈 입력값 (Global Inputs)
inputs = {
  global_regions  = local.regions
  project_name    = local.project_name
  kubeconfig_path = local.kubeconfig_path
  base_domain     = local.base_domain
}


```
