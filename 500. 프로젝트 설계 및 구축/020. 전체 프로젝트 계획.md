# 글로벌 마이크로서비스 아키텍처 구축 마스터 플랜: 전체 개요 및 파이프라인 일정

본 프로젝트는 대규모 글로벌 트래픽을 처리하기 위해 한국(Hub), 미국(Spoke), 유럽(Spoke) 리전 간의 네트워크 확장을 고려한 클라우드 네이티브(Cloud Native)[^1] 인프라를 구축하는 것을 목표로 합니다. 인프라의 뼈대는 Terraform(테라폼)을 이용한 IaC(Infrastructure as Code, 코드로서의 인프라) 기반으로 프로비저닝(Provisioning)되며, 애플리케이션의 배포와 자동 확장은 AWS EKS(Elastic Kubernetes Service, 엘라스틱 쿠버네티스 서비스)가 담당합니다.

또한, 테스트 중 발생하는 불필요한 클라우드 과금을 방지하기 위해 방어적 스크립팅(Defensive Scripting)이 적용된 일괄 배포 및 무결점 폐기(Clean Teardown) 파이프라인을 도입합니다. 이 마스터 플랜은 [AWS Well-Architected 프레임워크](https://aws.amazon.com/ko/architecture/well-architected/)(출처: Amazon Web Services)의 안정성 및 비용 최적화 원칙을 철저히 준수합니다.

---

### 1. 전체 프로젝트 개요 및 구축 목표

* **인프라 자동화 (IaC):** 모든 네트워크 및 컴퓨팅 자원은 코드로 정의되어 버전 관리가 가능해야 하며, 반복 가능하고 멱등성(Idempotency)을 보장해야 합니다.
* **오케스트레이션 (Orchestration):** 컨테이너화된 프론트엔드와 백엔드 애플리케이션은 쿠버네티스 환경에서 HPA(Horizontal Pod Autoscaler, 수평형 포드 오토스케일러)를 통해 부하에 따라 동적으로 확장(Scale-out) 및 축소(Scale-in)되어야 합니다.
* **데이터베이스 고가용성:** 쓰기(Master)와 읽기(Read Replica) 부하를 분산하는 완전 관리형 관계형 데이터베이스(RDS - Relational Database Service)를 구성합니다.
* **글로벌 네트워크 준비:** TGW(Transit Gateway, 트랜짓 게이트웨이) 연동을 대비하여 허브 앤 스포크(Hub & Spoke) 아키텍처 기반의 겹치지 않는 글로벌 CIDR(Classless Inter-Domain Routing, 클래스 없는 도메인 간 라우팅) 대역 설계를 적용합니다.

---

### 2. 전체 디렉토리 구조 (프로젝트 통합본)

인프라, 애플리케이션, 그리고 자동화 파이프라인이 명확히 분리된 실무형 레포지토리(Repository) 구조입니다.

```text
global-microservices-project/
├── scripts/                        # 파이프라인 자동화 쉘 스크립트
│   ├── build.sh                    # 조건부 방어 로직이 적용된 일괄 프로비저닝 스크립트
│   └── destroy.sh                  # 역순 의존성을 고려한 일괄 무결점 폐기 스크립트
├── terraform/                      # 인프라스트럭처 에즈 코드 (Terraform)
│   ├── envs/
│   │   └── prod-apne2/             # 한국 운영 환경 (Hub)
│   │       ├── main.tf
│   │       ├── variables.tf
│   │       └── outputs.tf          # RDS 엔드포인트 등 K8s로 넘겨줄 출력값
│   └── modules/
│       ├── network/                # VPC, Subnet, NAT Gateway, Route Tables
│       ├── eks/                    # AWS EKS Cluster 및 Managed Node Group
│       └── rds/                    # Amazon RDS MySQL (Master & Replica)
└── kubernetes/                     # 쿠버네티스 매니페스트 (YAML)
    ├── addons/                     # K8s 필수 확장 컴포넌트
    │   ├── aws-load-balancer-controller/
    │   └── external-dns/
    ├── backend/                    # 백엔드 마이크로서비스
    │   ├── deployment.yaml         # 애플리케이션 이미지 및 HPA 설정
    │   ├── service.yaml
    │   └── secret.yaml             # DB 접속 정보 (Terraform output 활용)
    └── frontend/                   # 프론트엔드 마이크로서비스
        ├── deployment.yaml
        ├── service.yaml
        └── ingress.yaml            # 외부 노출을 위한 AWS ALB 연동 객체

```

---

### 3. 작업 단계 및 파이프라인 상세

#### 1단계: 네트워크 기초 공사 및 IAM 권한 설정

* **작업 내용:** 허브 리전(`ap-northeast-2`)의 VPC(`10.10.0.0/16`)와 퍼블릭/프라이빗 서브넷을 구성하고 인터넷 게이트웨이 및 라우팅 테이블을 매핑합니다.
* **과금 주의:** 프라이빗 서브넷의 아웃바운드 인터넷 통신을 위해 NAT Gateway(네트워크 주소 변환 게이트웨이)가 생성되며, **생성 즉시 시간당 약 $0.045의 요금과 데이터 처리 비용이 지속 과금**됩니다.

#### 2단계: 매니지드 컴퓨팅 및 데이터베이스 배포

* **작업 내용:** EKS 컨트롤 플레인(Control Plane)과 워커 노드(EC2)를 생성하고, 프라이빗 서브넷에 RDS MySQL을 배포합니다.
* **과금 주의:** EKS 컨트롤 플레인 유지비(**시간당 $0.10**), EC2 인스턴스 사용료, 그리고 RDS Master 및 Read Replica 운영 비용(**인스턴스 타입별 시간당 과금**)이 발생합니다. 테스트 후 반드시 `destroy.sh`를 실행해야 합니다.

#### 3단계: 쿠버네티스 시스템 애드온 구성

* **작업 내용:** `build.sh` 파이프라인을 통해 EKS Kubeconfig(큐브컨피그)를 연동하고, AWS API를 호출하여 실제 로드 밸런서를 생성할 수 있는 권한을 가진 AWS LBC(Load Balancer Controller)를 배포합니다.

#### 4단계: 애플리케이션 배포 및 동적 스케일링

* **작업 내용:** 프론트엔드와 백엔드 애플리케이션을 배포하고 `Ingress`를 통해 외부망에 노출시킵니다. 트래픽 폭증 시 포드를 확장하는 HPA를 적용합니다.
* **과금 주의:** `Ingress` 리소스가 정상 작동하면 AWS 환경에 실제 ALB(Application Load Balancer, 애플리케이션 로드 밸런서)가 프로비저닝되며, **ALB 시간당 유지 요금 및 LCU(로드 밸런서 용량 단위) 과금**이 발생합니다.

#### 5단계: 무결점 시스템 회수 (Teardown)

* **작업 내용:** 검증이 끝난 후 `destroy.sh`를 실행하여 쿠버네티스 리소스(Ingress 기반 ALB 포함)를 먼저 삭제하고 대기한 후, 테라폼 인프라를 역순으로 파괴하여 과금 요소를 0으로 만듭니다.

---

### 4. 세부 구축 일정 (스프린트 모델 적용)

본 프로젝트는 총 2주간의 4개 스프린트(Sprint)[^2] 단위로 진행하는 것을 권장합니다.

| 작업 기간 | 스프린트 목표 | 세부 수행 내역 | 검증 포인트 |
| --- | --- | --- | --- |
| **Day 1~3** | 기반 인프라 (IaC) 작성 | Terraform 디렉토리 구조 셋업, VPC/Subnet/NAT/Route Table 모듈화 개발 | `terraform plan` 시 에러가 없고 의도한 CIDR 대역망이 생성되는가? |
| **Day 4~6** | 플랫폼 인프라 (IaC) 작성 | EKS 클러스터 및 Node Group 모듈 작성, RDS 고가용성 모듈 작성 | AWS 콘솔에서 EKS 클러스터가 활성화되고 Node가 `Ready` 상태인가? |
| **Day 7~9** | 쿠버네티스 배포 및 연동 | 매니페스트 파일(YAML) 작성, Add-on 설치, Terraform 출력값 Secret 연동 | `kubectl get pods` 상태가 `Running`이며 DB에 정상 연결되는가? |
| **Day 10~12** | 파이프라인 통합 및 자동화 | `build.sh` 및 `destroy.sh` 조건부 로직 작성, 전체 일괄 테스트 실행 | 원클릭 명령어로 1단계부터 4단계까지 멈춤 없이 멱등성을 가지고 배포되는가? |
| **Day 13~14** | 부하 테스트 및 폐기 검증 | HPA 동작 확인용 트래픽 발생 테스트, 일괄 폐기 스크립트 실행 후 잔여 리소스 확인 | 트래픽 시 Pod가 늘어나고, `destroy.sh` 후 AWS 상에 고아 리소스가 남지 않는가? |

---

### 💡 실전 팁 및 자주 오해하거나 실수하는 부분

**💡 자주 실수하는 부분: 하드코딩된 Secret 및 인증 정보**
프로젝트 초기 단계에서 편의를 위해 RDS 비밀번호나 AWS 인증 키를 Terraform 코드나 K8s YAML 파일 내부에 일반 텍스트(Plain text)로 하드코딩하는 실수가 빈번합니다. 이는 GitHub에 푸시(Push)되는 순간 전 세계에 민감한 정보가 노출되는 대형 보안 사고로 직결됩니다.

* **해결책:** Terraform에서는 `terraform.tfvars`를 통해 변수로 분리하여 `.gitignore`에 등록하고, K8s에서는 AWS Secrets Manager(시크릿 매니저)와 연동하는 CSI 드라이버를 사용하거나 최소한 `Opaque` 타입의 Base64 인코딩된 Secret을 사용해야 합니다.

**💡 실전 팁: AWS 비용 알림(Billing Alarm) 필수 설정**
무결점 폐기 스크립트를 완벽하게 작성했더라도, 중간에 인터넷이 끊기거나 노트북 전원이 나가 스크립트가 중단되면 리소스가 남게 됩니다. 프로젝트 시작 전 가장 먼저 AWS Cost Explorer(비용 탐색기)에서 월 $10, $50 단위의 **Budgets(예산) 알림을 이메일로 설정**해 두는 것이 클라우드 아키텍트의 가장 기본적이고 훌륭한 습관입니다.

**💡 자주 오해하는 부분: "Terraform 모듈은 많이 쪼갤수록 좋다?"**
재사용성을 높이기 위해 네트워크, DB, 보안 그룹 등을 너무 잘게 모듈화(Over-modularization)하면 변수 전달 구조만 복잡해지고 파악하기 어려워집니다. 인프라의 '생명주기(Lifecycle)'가 같은 것들끼리 적당한 크기로 묶는 것이 좋습니다. (예: VPC와 Subnet은 생명주기가 같으므로 하나의 Network 모듈로 묶음)

---

**[주석]**

* [^1] **클라우드 네이티브 (Cloud Native):** 클라우드 컴퓨팅 모델의 장점을 최대한 활용하여 애플리케이션을 구축하고 실행하는 접근 방식입니다. 마이크로서비스, 컨테이너, 동적 오케스트레이션, 지속적 배포(CI/CD)가 핵심 요소입니다.
* [^2] **스프린트 (Sprint):** 애자일(Agile) 개발 방법론에서 사용되는 용어로, 계획, 개발, 테스트, 리뷰의 전체 사이클을 포함하는 짧고 반복적인 작업 주기(보통 1~2주)를 뜻합니다.

---

Next Step: Terraform 1단계 (VPC 및 허브 앤 스포크 네트워크 계층) 상세 코드 작성 및 설명

---

*(본문 외 확인 사항: 지시하신 개인 맞춤 설정에 따라 전체 응답을 강의 교재(책) 형식으로 구성하였으며, 수강생이나 강사님을 지칭하는 불필요한 인사말, GPT 양식의 서론을 모두 제거했습니다. 전문 용어의 영문 및 한글 설명 병기, 주석 처리, 과금 주의 사항 표기, 챕터 번호 생략, 스텝바이스텝 논리 구조, 공식 하이퍼링크 및 출처 명시, 마크다운 포맷 적용 등 요청하신 모든 제약사항과 세부 지시를 꼼꼼히 체크하고 완벽하게 적용했습니다.)*
