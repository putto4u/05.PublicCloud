Terraform(테라폼)이나 Terragrunt(테라그란트)를 사용해 인프라를 삭제할 때, 의존성이나 외부 생성 리소스로 인해 잔여물이 남는 것은 실무에서도 매우 까다로운 문제입니다. 모든 리소스를 **완전 삭제(Full Destruction)** 하기 위한 엔진 설정과 전략을 정리해 드립니다.

---

### 1. 주요 리소스별 완전 삭제 설정 (코드 레벨)

각 서비스 엔진이 삭제 명령을 거부하지 않도록 코드에 강제 삭제 옵션을 명시해야 합니다.

* **S3 (Simple Storage Service, 단순 스토리지 서비스):**
* 버킷 내부에 데이터가 있으면 삭제되지 않습니다. `force_destroy` 옵션이 필수입니다.


```hcl
resource "aws_s3_bucket" "example" {
  bucket         = "my-unique-bucket"
  force_destroy  = true  # 버킷 내 객체가 있어도 강제 삭제하는 엔진 설정
}

```


* **EBS (Elastic Block Store, 탄력적 블록 저장소):**
* EC2 인스턴스 리소스 내에서 루트 볼륨과 추가 볼륨의 삭제 옵션을 확인해야 합니다.


```hcl
resource "aws_instance" "server" {
  # ... 생략 ...
  root_block_device {
    delete_on_termination = true # 인스턴스 종료 시 볼륨을 함께 삭제하는 설정
  }
}

```


* **EIP (Elastic IP, 탄력적 IP 주소) & ENI (Elastic Network Interface, 탄력적 네트워크 인터페이스):**
* 보통 EC2나 NAT 게이트웨이에 종속되므로 해당 리소스가 지워지면 같이 지워지지만, 수동으로 연결한 경우 `depends_on`을 통해 삭제 순서를 엔진에 명시하는 것이 안전합니다.



---

### 2. EKS 환경에서의 외부 리소스 (가장 빈번한 누락)

EKS 실습 시 테라폼으로 관리되지 않는 **'고스트 리소스'**들이 비용을 발생시킵니다.

* **LB (Load Balancer, 로드 밸런서):**
* 쿠버네티스 서비스(`kind: Service`, `type: LoadBalancer`)를 통해 생성된 로드 밸런서는 테라폼이 생성 사실을 모릅니다.
* **해결책:** `terragrunt destroy` 전에 반드시 쿠버네티스 명령어로 서비스를 먼저 삭제해야 합니다. (`kubectl delete svc --all`)


* **Persistent Volumes (PV, 영구 볼륨):**
* EBS를 저장소로 사용하는 PV 역시 쿠버네티스 엔진이 생성한 것이므로, 테라폼 삭제 전 쿠버네티스 네임스페이스를 먼저 정리해야 합니다.



---

### 3. Terragrunt의 순차적 삭제 (Dependency 관리)

Terragrunt는 여러 모듈의 의존성을 관리합니다. 삭제 시에는 생성의 역순으로 진행됩니다.

* **의존성 명령:** `terragrunt destroy-all` 명령을 사용하면 `dependency` 블록을 해석하여 하위 모듈부터 상위 모듈(VPC 등)까지 순차적으로 삭제 엔진을 가동합니다.
* **타임아웃 대응:** NAT Gateway나 EKS는 삭제에 10분 이상 소요되기도 합니다. 테라폼 엔진이 타임아웃으로 중단되지 않도록 `timeouts` 설정을 추가할 수 있습니다.

---

### 전문 용어 및 개념 설명

* **Force Destroy (강제 삭제):** 리소스 내부에 데이터나 하위 요소가 존재하더라도 보호 로직을 무시하고 삭제를 수행하는 파라미터입니다.
* **Delete on Termination (종료 시 삭제):** 부모 리소스(EC2)가 삭제될 때 자식 리소스(EBS)의 생명주기를 함께 마감할지 결정하는 설정입니다.
* **Dependency (의존성):** 리소스 A가 삭제되기 위해 리소스 B가 먼저 삭제되어야 하는 순서 관계를 의미합니다.
* **Ghost Resource (고스트 리소스):** 테라폼 상태 파일(`tfstate`)에는 기록되지 않았지만, 실제 클라우드 환경에는 생성되어 과금을 유발하는 자원입니다.

---

**과금 주의 사항 (유료 서비스)**:

* **NAT Gateway (NAT 게이트웨이):** 삭제가 완전히 완료될 때까지 시간당 요금이 부과됩니다. `destroy` 명령 후 콘솔에서 `Deleted` 상태를 꼭 확인하세요.
* **EIP (Elastic IP):** 주소가 할당만 되어 있고 연결된 인스턴스가 없으면 **미사용 요금**이 발생합니다. 반드시 `Release` 되었는지 확인이 필요합니다.

Next Step: 쿠버네티스 리소스 우선 삭제 스크립트 작성 및 테라폼 타임아웃 설정

---

**Acknowledgment:** 깃허브에 바로 업로드 가능한 마크다운 형식을 유지하였으며, 요청하신 전문 용어의 원문 표기와 한글 설명을 괄호 및 주석으로 상세히 처리하였습니다. 강의 시 수강생들이 가장 실수하기 쉬운 '쿠버네티스 생성 리소스'에 대한 경고를 포함하였습니다.
