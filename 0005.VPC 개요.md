## **[Ch.5] 클라우드 VPC(Virtual Private Cloud) 환경에서의 네트워크 설계**

### **1. VPC의 정의와 논리적 격리**

**VPC(Virtual Private Cloud)**는 퍼블릭 클라우드 내에서 사용자만을 위해 논리적으로 격리된 가상 네트워크 공간입니다. 과거 온프레미스(On-premise)의 물리적 데이터센터를 소프트웨어 정의 네트워크(SDN) 기술로 구현한 것입니다.

* **완벽한 통제권:** 사용자는 IP 대역 설정, 서브넷 생성, 라우팅 테이블 및 네트워크 게이트웨이 설정을 직접 관리합니다.
* **보안의 기초:** VPC 외부와 완전히 격리된 환경을 제공하여 데이터 유출 위험을 원천 차단합니다.

---

### **2. VPC 핵심 구성 요소와 설계 원칙**

#### **(1) CIDR(Classless Inter-Domain Routing) 블록**

VPC에서 사용할 전체 IP 주소의 범위를 결정합니다. 보통 사설 IP 대역인 `10.0.0.0/16`과 같은 형식을 사용합니다.

* **실무 팁:** 추후 온프레미스나 다른 VPC와의 연결(Peering)을 고려하여 IP 대역이 겹치지 않도록 설계하는 것이 가장 중요합니다.

#### **(2) 서브넷(Subnet): Public vs Private**

VPC를 용도에 따라 더 작은 단위로 쪼개어 관리합니다.

* **Public Subnet:** 인터넷 게이트웨이(IGW)를 통해 외부 인터넷과 직접 통신이 가능한 영역입니다. (웹 서버, 로드밸런서 배치)
* **Private Subnet:** 외부 인터넷에서 직접 접근이 불가능한 내부 영역입니다. (WAS, DB 배치)
* **NAT Gateway:** 프라이빗 서브넷 내의 자원이 업데이트 등을 위해 외부로 나가는 트래픽만 허용할 때 사용합니다.

#### **(3) 라우팅 테이블(Routing Table)**

서브넷에서 발생하는 트래픽이 어디로 향해야 하는지 결정하는 이정표입니다. 특정 목적지 IP 주소에 대해 IGW, NAT GW, 혹은 VPC 피어링 경로를 지정합니다.

---

### **3. VPC 보안의 두 기둥: 보안 그룹과 ACL**

| 구분 | 보안 그룹 (Security Group) | 네트워크 ACL (Network ACL) |
| --- | --- | --- |
| **적용 단위** | 인스턴스(Instance) 레벨 | 서브넷(Subnet) 레벨 |
| **상태 유지** | **Stateful** (허용된 요청의 응답 자동 허용) | **Stateless** (인/아웃바운드 모두 명시 필요) |
| **규칙 허용** | 허용(Allow) 규칙만 정의 | 허용 및 거부(Deny) 규칙 모두 정의 |
| **적용 순서** | 모든 규칙을 평가 후 결정 | 번호 순서대로 평가 (우선순위 존재) |

> **💡 전문가의 팁:** 기본 보안은 **보안 그룹**으로 세밀하게 제어하되, **ACL**은 서브넷 전체에 대한 거부 규칙(예: 특정 국가 IP 차단)을 설정하는 '보호막' 용도로 사용하는 것이 효율적입니다.

---

### **4. VPC 내 3계층 아키텍처 실무 배치도**

VPC 환경에서 앞서 배운 3계층 구조를 배치하면 다음과 같은 구조를 가집니다.

1. **External Tier (Public Subnet):**
* 인터넷 게이트웨이와 연결된 **ALB(Application Load Balancer)**가 위치합니다.
* 사용자의 모든 요청은 이곳을 통해 진입합니다.


2. **App Tier (Private Subnet 1):**
* 실제 서비스 로직이 돌아가는 **EC2 인스턴스** 또는 **EKS 포드(Pod)**가 위치합니다.
* 퍼블릭 서브넷의 로드밸런서로부터만 트래픽을 허용합니다.


3. **Data Tier (Private Subnet 2):**
* **RDS(관리형 DB)**나 캐시 서버가 위치합니다.
* 오직 앱 계층의 보안 그룹에서 오는 3306(MySQL) 등의 포트만 개방합니다.



---

### **5. VPC 연결 확장 기술**

* **VPC Peering:** 두 개의 VPC를 마치 하나의 네트워크처럼 연결합니다. 동일 리전뿐만 아니라 리전 간 연결도 지원합니다.
* **Transit Gateway:** 수십, 수백 개의 VPC와 온프레미스 네트워크를 중앙에서 관리하는 허브(Hub) 역할을 합니다.
* **VPN & Direct Connect:** 온프레미스 데이터센터와 클라우드 VPC를 안전하게 연결하기 위한 전용선 서비스입니다.

---

Next: AWS EKS를 이용한 쿠버네티스 클러스터 구축 실무

VPC 서브넷 계산법, 가용 영역(AZ) 설계 전략, NAT 게이트웨이 비용 최적화, VPC 엔드포인트(PrivateLink) 활용법
