이번 과정에서는 **Terragrunt(테라그런트)**를 사용하여 개별 리소스를 선별적으로 삭제한 뒤, 다시 전체 인프라를 복구하고, 마지막으로 프로젝트 전체를 정리하는 운영 사이클을 실습합니다.

---

## 1. 개별 리소스 선별 삭제 (Individual Destroy)

복잡한 인프라 환경에서 특정 서비스만 업데이트하거나 제거해야 할 때 사용하는 방식입니다. 각 서비스의 배포 설정 디렉토리로 이동하여 실행합니다.

### 1.1 서비스별 순차 삭제

각 디렉토리에서 해당 서비스만 삭제 명령을 내립니다.

```bash
# 1. Nginx 삭제
cd ~/k8s-project/live/dev/nginx/
terragrunt destroy -auto-approve

# 2. Python Web 삭제
cd ~/k8s-project/live/dev/python-web/
terragrunt destroy -auto-approve

# 3. MySQL 삭제
cd ~/k8s-project/live/dev/mysql/
terragrunt destroy -auto-approve

```

---

## 2. 전체 인프라 통합 배포 (Full Deployment)

삭제된 모든 리소스를 다시 한 번에 배포합니다. `run-all` 명령어를 사용하여 `live/dev` 하위의 모든 설정을 한꺼번에 적용합니다.

### 2.1 통합 배포 실행

상위 디렉토리에서 명령어를 실행하여 의존성에 따라 모든 서비스를 생성합니다.

```bash
cd ~/k8s-project/live/dev/

# 모든 프로젝트 일괄 배포
terragrunt run-all apply --terragrunt-non-interactive

```

### 2.2 배포 상태 확인

모든 Pod(포드)가 정상적으로 생성되었는지 확인합니다.

```bash
kubectl get pods

```

---

## 3. 프로젝트 전체 삭제 (Full Destroy)

실습이 끝난 후 자원을 회수하기 위해 모든 리소스를 한꺼번에 삭제합니다.

### 3.1 일괄 삭제 실행

`run-all destroy` 명령을 사용하여 프로젝트 전체를 정리합니다.

```bash
cd ~/k8s-project/live/dev/

# 모든 프로젝트 일괄 삭제
terragrunt run-all destroy --terragrunt-non-interactive

```

---

## 4. 핵심 개념 정리

> **주석 (Note)**
> * **-auto-approve**: 실행 시 사용자의 최종 승인(yes 입력) 단계를 생략하고 즉시 명령을 수행합니다. 자동화 스크립트 작성 시 유용합니다.
> * **--terragrunt-non-interactive**: Terragrunt가 실행 중에 사용자에게 묻는 모든 질문에 대해 기본값(보통 yes)으로 응답하며 중단 없이 진행하게 합니다.
> * **멱등성(Idempotency)**: 테라폼과 테라그런트는 여러 번 실행해도 현재 상태가 설정 파일과 같다면 아무런 변화를 일으키지 않습니다. 이미 삭제된 상태에서 다시 삭제를 요청해도 에러 없이 성공으로 처리됩니다.
> 
> 

---

Next Step: **Terragrunt State(상태 파일) 백엔드 설정을 통한 협업 환경 구축**

본 실습은 사용자 **Ubuntu VM** 내부 자원을 사용하므로 별도의 과금은 발생하지 않습니다. 하지만 AWS 등 퍼블릭 클라우드에서 실행할 경우, `run-all apply` 이후 리소스를 삭제하지 않고 방치하면 인스턴스 및 로드밸런서 비용이 지속적으로 발생하므로 실습 종료 후 반드시 `run-all destroy`를 수행해야 합니다.

Next Step: State 백엔드 설정 방법

**지정하신 교재 형식과 가이드라인에 맞춰 작성되었습니다.**
