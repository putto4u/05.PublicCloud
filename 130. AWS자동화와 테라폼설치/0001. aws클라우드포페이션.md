# AWS CloudFormation의 이해

AWS CloudFormation은 AWS 클라우드 환경에서 인프라를 코드로 정의하고 자동화된 방식으로 프로비저닝(Provisioning, IT 인프라를 설정하고 배치하여 사용할 수 있도록 준비하는 과정)할 수 있게 해주는 핵심 서비스입니다. 이러한 접근 방식을 기술적으로 IaC(Infrastructure as Code, 코드로서의 인프라)라고 정의합니다. 인프라의 상태를 문서(코드)로 선언하면, CloudFormation 엔진이 해당 코드를 해석하여 실제 AWS 환경에 동일하게 아키텍처를 구현합니다.

> ⚠️ **비용 및 과금 주의 사항**
> AWS CloudFormation 서비스 자체를 사용하는 엔진 호출 및 스택 관리 비용은 **무료**입니다. 하지만 템플릿을 통해 프로비저닝되는 EC2(Elastic Compute Cloud, 확장 가능한 클라우드 컴퓨팅 용량 제공 서비스), RDS(Relational Database Service, 관계형 데이터베이스 서비스) 등의 실제 AWS 리소스들은 생성되는 즉시 각 서비스의 과금 정책에 따라 **유료 과금**이 시작됩니다.

---

### 1. 핵심 구성 요소

CloudFormation을 이해하기 위해서는 다음의 세 가지 핵심 개념을 명확히 인지해야 합니다.

* **템플릿 (Template):**
인프라의 설계도 역할을 하는 텍스트 파일입니다. JSON(JavaScript Object Notation, 경량의 데이터 교환 형식) 또는 YAML(YAML Ain't Markup Language, 사람이 읽기 쉬운 데이터 직렬화 언어) 포맷으로 작성됩니다. 원하는 리소스와 그 속성, 리소스 간의 종속성을 선언적으로 기술합니다.
* **스택 (Stack):**
템플릿을 인스턴스화한 결과물로, 하나의 템플릿을 통해 생성, 업데이트, 삭제되는 AWS 리소스들의 단일 논리적 그룹입니다. 인프라를 개별 리소스가 아닌 스택 단위로 통합 관리하게 됩니다.
* **변경 세트 (Change Set):**
운영 중인 스택의 템플릿을 수정하여 업데이트하고자 할 때, 변경 사항을 즉시 적용하지 않고 사전에 실행 중인 리소스에 미칠 영향을 미리 평가하고 검토할 수 있도록 해주는 안전 장치입니다.

### 2. 작동 원리 및 아키텍처

1. **코드 작성:** 로컬 환경이나 저장소에서 YAML 또는 JSON 형태의 템플릿 코드를 작성합니다.
2. **스토리지 저장:** 작성된 템플릿 파일은 로컬에서 직접 업로드하거나 Amazon S3(Simple Storage Service, 확장성과 데이터 가용성을 제공하는 객체 스토리지 서비스) 버킷에 저장됩니다.
3. **스택 생성/업데이트:** CloudFormation 엔진이 S3에 저장된 템플릿을 읽어 종속성 그래프를 생성하고, 최적화된 순서에 따라 AWS API(Application Programming Interface, 애플리케이션 프로그래밍 인터페이스)를 호출하여 리소스를 배치합니다.

---

### 3. 실전 팁 및 자주 발생하는 실수 (Troubleshooting)

**💡 실전 팁: DeletionPolicy (삭제 정책)의 적극적 활용**
스택을 삭제할 때 내부 리소스도 함께 삭제되는 것이 기본 동작입니다. 그러나 RDS와 같은 중요 데이터베이스 컴포넌트의 경우 템플릿 내에 `DeletionPolicy: Retain` (삭제 정책: 유지) 또는 `DeletionPolicy: Snapshot` (삭제 정책: 스냅샷 생성) 속성을 명시하여, 스택 오작동이나 실수로 인한 치명적인 데이터 유실을 방지해야 합니다.

**🚫 치명적인 실수: 콘솔에서의 수동 리소스 변경 (Drift 발생)**
CloudFormation으로 배포된 인프라 리소스(예: 보안 그룹의 포트 개방)를 AWS 웹 콘솔 화면에서 관리자가 수동으로 수정하는 것은 IaC 환경에서 가장 피해야 할 안티 패턴입니다.

* **결과:** 코드(템플릿)의 상태와 실제 인프라의 상태가 불일치하게 되는 형상 드리프트(Drift) 현상이 발생합니다. 이후 스택 업데이트 시 충돌이 발생하여 배포가 실패할 수 있습니다.
* **해결책:** 항상 코드를 수정하여 스택을 업데이트해야 하며, 주기적으로 **Drift Detection(드리프트 감지, 코드로 정의된 상태와 실제 인프라 상태 간의 차이를 확인하는 기능)** 을 실행하여 인프라의 무결성을 검증해야 합니다.

---

### 4. 실전 템플릿 예제 (YAML)

다음은 단일 EC2 인스턴스를 프로비저닝하는 가장 기초적인 YAML 템플릿 구조입니다.

```yaml
AWSTemplateFormatVersion: '2010-09-09'
Description: 'A simple EC2 instance provisioning template'

Resources:
  MyWebServer:
    Type: 'AWS::EC2::Instance'
    Properties:
      InstanceType: 't2.micro' # 주의: t2.micro는 프리티어 적용이 가능하나, 초과시 과금됩니다.
      ImageId: 'ami-0c55b159cbfafe1f0' # 해당 리전의 최신 Amazon Linux 2 AMI ID로 변경 필요
      Tags:
        - Key: 'Name'
          Value: 'WebServer-01'

```

---
# AWS CloudFormation 심층 분석 및 Terraform과의 실무 비교 가이드

AWS 공식 문서의 최신 아키텍처 가이드와 2026년 기준 실무 전문가들의 현장 검증 사례를 바탕으로, AWS CloudFormation의 고급 기능과 HashiCorp(해시코프)의 Terraform(테라폼) 간의 심층 비교 분석을 제공합니다.

---

### 1. AWS CloudFormation 심층 기능 및 최신 동향 (2026 기준)

단순한 리소스 프로비저닝을 넘어, 대규모 엔터프라이즈 환경에서 CloudFormation을 활용하기 위한 핵심 고급 기능은 다음과 같습니다.

* **StackSets(스택세트, 여러 AWS 계정 및 리전에 걸쳐 스택을 배포하는 기능):**
단일 템플릿을 사용하여 조직 내 수십 개의 AWS 계정과 여러 리전에 동일한 인프라를 병렬로 배포하고 관리할 수 있습니다. 중앙 집중식 거버넌스 및 보안 정책(예: 모든 계정에 동일한 IAM(Identity and Access Management, AWS 리소스에 대한 액세스를 안전하게 제어하는 서비스) 역할 배포) 적용에 필수적입니다.
* **상태 관리의 캡슐화 (Encapsulated State Management):**
CloudFormation은 배포된 리소스의 상태를 AWS 인프라 내부에서 자체적으로 추적하고 관리합니다. 사용자가 별도의 상태 파일을 백업하거나 잠금(Lock) 처리를 할 필요가 없어 운영 오버헤드가 적습니다.
* **IaC Generator(IaC 생성기) 및 AI 검증 도입:**
최근 AWS는 콘솔에서 수동으로 생성한 리소스를 스캔하여 역으로 CloudFormation 템플릿 코드를 추출하는 IaC Generator 기능을 고도화했습니다. 또한, 배포 전 보안 취약점(예: S3(Simple Storage Service, 객체 스토리지 서비스) 퍼블릭 액세스 차단 누락)을 식별하는 사전 템플릿 검증(Proactive Template Validation) 기능이 강화되었습니다.

> ⚠️ **비용 및 과금 주의 사항**
> CloudFormation 서비스 자체와 기본 기능(StackSets, Drift Detection 등)의 사용은 **무료**입니다. 그러나 템플릿을 통해 생성되는 인프라 리소스는 생성 시점부터 각 서비스 요율에 따라 **과금**됩니다.

---

### 2. 아키텍처 및 철학 비교: CloudFormation vs Terraform

IaC(Infrastructure as Code, 코드로서의 인프라) 도구를 선택할 때 가장 중요한 것은 각 도구가 가진 설계 철학을 이해하는 것입니다.

| 비교 항목 | AWS CloudFormation | Terraform |
| --- | --- | --- |
| **적용 범위 (Scope)** | AWS 환경 전용 (AWS Native) | 멀티 클라우드 및 온프레미스[^1] 호환 (Cloud Agnostic) |
| **작성 언어 (Syntax)** | JSON(JavaScript Object Notation, 경량의 데이터 교환 형식) 또는 YAML(YAML Ain't Markup Language, 데이터 직렬화 언어) | HCL(HashiCorp Configuration Language, 해시코프에서 개발한 선언적 인프라 구성 언어)[^2] |
| **상태 관리 (State)** | AWS 서비스 내부에서 완전 관리 (보이지 않음) | `.tfstate` 파일(상태 파일) 형태로 존재. 사용자가 직접 S3 등에 저장 및 암호화 관리 필요 |
| **모듈화 및 재사용성** | Nested Stacks(중첩 스택) 및 Macros(매크로) 활용. 다소 복잡함. | Registry(레지스트리)를 통한 모듈 공유. 재사용성과 로직 처리가 매우 뛰어남. |
| **실행 속도 및 롤백** | 느린 편. 실패 시 스택 전체를 이전 상태로 안전하게 자동 롤백함. | 매우 빠름. 실패한 리소스만 중단되며, 롤백은 관리자가 수동으로 코드를 수정하여 적용해야 함. |
| **라이선스 및 비용** | AWS 기본 제공 (무료) | 오픈소스 (CLI 무료). 단, 협업 및 정책 제어가 필요한 **Terraform Cloud / Enterprise 버전은 유료 과금**됨. |

---

### 3. 실무 전문가 및 아키텍트들의 도입 선택 가이드 (Decision Matrix)

현업 엔지니어와 클라우드 아키텍트들의 실제 운영 경험을 종합한 IaC 도구 선택의 기준입니다.

**💡 Terraform을 선택해야 하는 경우 (업계 선호도 우위)**

* **멀티 클라우드 전략:** AWS 외에 Azure(애저), GCP(Google Cloud Platform, 구글 클라우드 플랫폼) 등 다양한 클라우드 벤더를 혼합하여 사용하거나 향후 확장 계획이 있는 경우, 단일 HCL 문법으로 모든 프로바이더를 제어할 수 있는 Terraform이 압도적으로 유리합니다.
* **복잡한 로직 및 DX(Developer Experience, 개발자 경험):** 반복문(`for_each`, `count`), 조건문 등 프로그래밍적인 처리가 필요할 때 YAML/JSON 기반의 CloudFormation은 코드가 기하급수적으로 길어지고 가독성이 떨어집니다. HCL은 이러한 복잡성을 우아하게 해결합니다.
* **빠른 실행 환경 (Dry Run):** Terraform의 `terraform plan` 명령어는 실제 배포 전 변경될 리소스를 빠르고 명확하게 시각화해 줍니다. CloudFormation의 Change Sets(변경 세트)보다 직관적이고 빠르다는 평가가 지배적입니다.

**💡 CloudFormation을 선택해야 하는 경우**

* **AWS 100% 종속 환경 (All-in AWS):** 조직의 모든 인프라가 AWS 내에 존재하고 서드파티 도구에 대한 의존성이나 외부 상태 파일(.tfstate)을 관리할 운영 인력이 부족하다면, 관리형 서비스인 CloudFormation이 가장 안전한 선택입니다.
* **엄격한 보안 및 규정 준수:** 외부 툴 설치 없이 AWS 콘솔 내에서 모든 권한 통제(IAM)와 감사가 완벽하게 통합되어야 하는 금융/공공 부문에서 선호됩니다.
* **Day-0 지원:** AWS의 새로운 서비스나 기능이 출시되었을 때, CloudFormation은 즉시 지원되는 경우가 많습니다. Terraform은 커뮤니티나 HashiCorp에서 Provider(프로바이더, 테라폼과 외부 API를 연결하는 플러그인)를 업데이트할 때까지 약간의 시차가 발생할 수 있습니다.

**🚫 실전 팁: 대안적 접근 (AWS CDK)**
최근 개발자 중심의 조직에서는 YAML 작성의 고통을 줄이기 위해 **CDK(Cloud Development Kit, 익숙한 프로그래밍 언어로 클라우드 인프라를 정의하는 AWS의 오픈소스 소프트웨어 개발 프레임워크)** 의 도입이 급증하고 있습니다. Python(파이썬), TypeScript(타입스크립트) 등으로 인프라 코드를 작성하면 내부적으로 CloudFormation 템플릿으로 변환(Synthesize)되어 배포되는 방식입니다. 인프라 전담 엔지니어보다는 애플리케이션 개발자가 인프라까지 배포해야 할 때 매우 효과적입니다.

---

[^1]: 온프레미스(On-Premises): 기업이 자체적으로 데이터 센터나 서버실을 구축하고 IT 인프라 하드웨어 및 소프트웨어를 직접 관리하고 운영하는 전통적인 환경을 의미합니다.
[^2]: HCL(HashiCorp Configuration Language): JSON이나 YAML이 갖는 정적인 데이터 구조의 한계를 넘어, 변수 선언, 반복문, 모듈 가져오기 등의 동적이고 프로그래밍적인 구조를 지원하도록 특별히 설계된 인프라 정의 언어입니다.

---

**Reference**

* [AWS CloudFormation 공식 가이드 (User Guide)](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/Welcome.html)
* [HashiCorp Terraform vs CloudFormation 공식 문서](https://developer.hashicorp.com/terraform/intro/vs/cloudformation)

---

