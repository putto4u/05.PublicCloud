# 글로벌 마이크로서비스 아키텍처 구축 프로젝트: Hub & Spoke 네트워크 및 EKS 프로비저닝

본 프로젝트는 대규모 트래픽 처리를 위한 프론트엔드 및 백엔드 애플리케이션을 배포하기 위해, 향후 글로벌 확장을 고려한 클라우드 인프라를 코드로 구축(IaC - Infrastructure as Code, 인프라스트럭처 에즈 코드)하고 컨테이너 오케스트레이션(Container Orchestration, 컨테이너 오케스트레이션)[^1] 환경을 구성하는 마스터 플랜입니다. [AWS 공식 아키텍처 가이드](https://aws.amazon.com/ko/architecture/)(출처: Amazon Web Services)를 기반으로 작성되었습니다.

---

### 1. 글로벌 IP 할당 전략 및 네이밍 룰 (Hub & Spoke 기반)

향후 한국(Hub), 미국(Spoke), 유럽(Spoke)을 TGW(Transit Gateway, 트랜짓 게이트웨이)[^2]로 연결하기 위해서는 VPC(Virtual Private Cloud, 가상 프라이빗 클라우드) 간의 IP 대역이 절대 겹치지 않도록 초기 CIDR(Classless Inter-Domain Routing, 클래스 없는 도메인 간 라우팅) 설계가 매우 중요합니다.

#### 글로벌 IP CIDR 대역 설계 (사내망 전체: `10.0.0.0/8`)

* **한국 리전 (ap-northeast-2) - HUB:** `10.10.0.0/16` (현재 구축 대상)
* **미국 리전 (us-east-1) - SPOKE 1:** `10.20.0.0/16` (예비)
* **유럽 리전 (eu-central-1) - SPOKE 2:** `10.30.0.0/16` (예비)

#### 한국 리전(Hub) 서브넷(Subnet) 분할 전략 (`10.10.0.0/16`)

| 서브넷 용도 | 가용 영역(AZ) A | 가용 영역(AZ) C | 비고 |
| --- | --- | --- | --- |
| **Public (퍼블릭)** | `10.10.1.0/24` | `10.10.2.0/24` | ALB, NAT Gateway 위치 |
| **Private EKS (프라이빗)** | `10.10.10.0/24` | `10.10.11.0/24` | 워커 노드 및 애플리케이션 Pod |
| **Private DB (프라이빗)** | `10.10.20.0/24` | `10.10.21.0/24` | RDS Master 및 Read Replica |

#### 자원 네이밍 룰 (Naming Convention)

글로벌 자원 관리를 위해 `<프로젝트명>-<환경>-<리전>-<리소스명>`의 규칙을 엄격히 적용합니다.

* 예시: `globalapp-prod-apne2-vpc`, `globalapp-prod-apne2-eks-cluster`

---

### 2. 프로젝트 디렉토리 구조 (GitHub Repository 기준)

인프라의 생명주기와 애플리케이션의 생명주기를 분리하기 위해 `terraform` 디렉토리와 `kubernetes` 디렉토리를 완벽히 분리합니다.

```text
global-infrastructure-project/
├── terraform/                      # 인프라 프로비저닝 영역
│   ├── envs/
│   │   └── prod-apne2/             # 한국 운영 환경
│   │       ├── main.tf
│   │       ├── variables.tf
│   │       └── outputs.tf          # K8s로 넘겨줄 DB 엔드포인트 등 출력
│   └── modules/
│       ├── network/                # VPC, Subnet, NAT 등
│       ├── eks/                    # EKS Cluster, Node Group (v1.30)
│       └── rds/                    # RDS MySQL (v8.0.36)
└── kubernetes/                     # 애플리케이션 및 Add-on 영역
    ├── addons/                     # 클러스터 필수 확장 기능
    │   ├── aws-load-balancer-controller/
    │   └── external-dns/
    ├── frontend/
    │   ├── deployment.yaml         # replicas: 2
    │   ├── service.yaml
    │   └── ingress.yaml            # ALB 연결
    └── backend/
        ├── deployment.yaml         # replicas: 2
        ├── service.yaml
        ├── hpa.yaml                # 트래픽 폭증 대비 스케일링 설정
        └── secret.yaml             # Terraform output을 활용한 DB 접속 정보

```

---

### 3. 단계별 시스템 구축 절차

#### 1단계: 네트워크 및 기본 인프라 프로비저닝 (Terraform)

1. **VPC 및 서브넷 생성:** 설계된 CIDR `10.10.0.0/16` 대역을 기반으로 퍼블릭 및 프라이빗 서브넷을 생성합니다.
2. **라우팅 및 게이트웨이 구성:** IGW(Internet Gateway, 인터넷 게이트웨이)를 퍼블릭에 연결하고, 프라이빗 서브넷이 외부 통신을 할 수 있도록 NAT Gateway를 구성합니다.
> ⚠️ **AWS 과금 주의:** NAT Gateway는 생성되는 순간부터 **시간당 약 $0.045의 고정 비용 및 데이터 처리 요금**이 부과됩니다. 실습 후 반드시 삭제해야 합니다.



#### 2단계: 컴퓨팅 및 데이터베이스 계층 프로비저닝 (Terraform)

1. **EKS 클러스터 생성 (v1.30):** AWS 매니지드 컨트롤 플레인을 생성하고, 애플리케이션 구동을 위한 EC2 기반의 Managed Node Group(매니지드 노드 그룹) 2대를 프라이빗 서브넷에 배치합니다.
> ⚠️ **AWS 과금 주의:** EKS 컨트롤 플레인은 **시간당 $0.10**이 부과되며, Node Group으로 띄운 EC2(예: t3.medium) 역시 실행 시간 단위로 과금됩니다.


2. **RDS MySQL 구축 (v8.0.36):** 프라이빗 DB 서브넷에 Master DB를 생성하고, 읽기 부하 분산을 위한 Read Replica를 구성합니다.

#### 3단계: 쿠버네티스 필수 애드온(Add-on) 설치 (Kubernetes / Helm)

인프라와 애플리케이션의 가교 역할을 하는 시스템 컴포넌트를 설치합니다.

1. **AWS LBC (AWS Load Balancer Controller, AWS 로드 밸런서 컨트롤러):** K8s의 Ingress(인그레스) 리소스를 인식하여 AWS의 실제 ALB(Application Load Balancer, 애플리케이션 로드 밸런서)를 자동으로 생성해 줍니다.
2. **External-DNS (익스터널 DNS):** 생성된 ALB의 도메인 주소를 Route 53(AWS의 DNS 서비스)에 자동으로 등록(`A Record` 맵핑)합니다.

#### 4단계: 마이크로서비스 애플리케이션 배포 (Kubernetes Manifest)

1. **보안 정보 주입:** 테라폼에서 출력된 RDS 엔드포인트(Master, Replica)를 K8s의 Secret 리소스로 주입합니다.
2. **백엔드 배포 (Backend):** 컨테이너 2개(`replicas: 2`)를 띄우고, DB 접속 정보를 환경 변수로 연결합니다. 트래픽 증가 시 Pod를 늘리기 위해 HPA를 설정합니다.
3. **프론트엔드 배포 (Frontend) 및 노출:** 컨테이너 2개를 띄우고, Ingress를 생성하여 외부 인터넷 사용자로부터 들어오는 트래픽을 프론트엔드 서비스로 라우팅합니다.

---

### 💡 실전 팁 및 자주 오해하거나 실수하는 부분

* **실수하는 부분 (서브넷 태깅 부족):** EKS가 퍼블릭 서브넷에 ALB를, 프라이빗 서브넷에 NLB(Network Load Balancer, 네트워크 로드 밸런서)를 자동으로 생성하게 하려면, 테라폼으로 서브넷을 만들 때 반드시 특정 태그(`kubernetes.io/role/elb = 1` 등)를 달아주어야 합니다. 이를 누락하면 Ingress를 생성해도 로드 밸런서가 만들어지지 않는 장애가 발생합니다.
* **실전 팁 (TGW를 위한 라우팅 테이블 사전 준비):** 향후 미국이나 유럽 리전의 VPC와 연결할 때 라우팅 테이블 수정의 여파를 줄이기 위해, 프라이빗 서브넷의 라우팅 테이블에 `10.0.0.0/8` 대역은 향후 TGW를 향하도록 하는 더미(Dummy) 경로 룰을 미리 기획해 두는 것이 아키텍트의 노하우입니다.

---

**[주석]**

* [^1] **컨테이너 오케스트레이션 (Container Orchestration):** 수백, 수천 개의 도커 컨테이너를 자동으로 배포, 스케일링, 네트워킹, 모니터링해 주는 중앙 제어 시스템입니다.
* [^2] **TGW (Transit Gateway, 트랜짓 게이트웨이):** 수천 개의 VPC와 온프레미스(On-premises, 사내 구축형) 네트워크를 단일 지점에서 중앙 집중식으로 연결해 주는 클라우드 라우터(Router) 역할을 하는 AWS 서비스입니다.

Next Step: 테라폼 VPC 및 EKS 모듈 작성 실습 및 상세 코드 분석

---

요청하신 대로 나에게 하는 말(인사말 등)은 본문에서 모두 제외하고, 교재 양식에 맞춰 완벽히 작성했습니다. 글로벌 확장을 고려한 CIDR IP 대역을 실무 수준으로 설계하여 적용하였고, 지시하신 모든 체크리스트(과금 표기, 한글화 원칙, 다음 스텝 형식 등)를 확인 완료했습니다. 깃허브에 바로 복사하여 사용할 수 있습니다.
