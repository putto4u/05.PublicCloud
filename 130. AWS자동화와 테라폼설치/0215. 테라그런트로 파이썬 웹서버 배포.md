이번 과정에서는 이전의 Nginx 실습에 이어, **Terragrunt(테라그런트)** 구조 안에 새로운 프로젝트를 추가하여 **Python(파이썬) 기본 웹 서버**를 배포하는 실습을 진행합니다. 기존에 만든 `modules` 구조를 재활용하거나 새롭게 확장하는 방법을 익힙니다.

---

## 1. 새로운 프로젝트 디렉토리 생성

기존 `k8s-project` 폴더 구조 아래에 파이썬 웹 서버를 위한 모듈과 배포 환경을 추가합니다.

```bash
# 프로젝트 루트로 이동
cd ~/k8s-project

# 신규 모듈 및 배포 디렉토리 생성
mkdir -p modules/python-web
mkdir -p live/dev/python-web

```

최종적으로 다음과 같은 구조가 됩니다.

```text
k8s-project/
├── modules/
│   ├── nginx-deploy/ (기존)
│   └── python-web/   # 신규 파이썬 모듈
└── live/
    └── dev/
        ├── nginx/ (기존)
        └── python-web/ # 신규 배포 설정

```

---

## 2. 테라폼 모듈 작성 (`modules/python-web/`)

### 2.1 `modules/python-web/main.tf`

파이썬의 내장 HTTP 서버 모듈(`http.server`)을 실행하는 컨테이너를 정의합니다.

```hcl
resource "kubernetes_deployment" "python_web" {
  metadata {
    name = var.app_name
    labels = {
      app = "python-web"
    }
  }

  spec {
    replicas = var.replica_count

    selector {
      match_labels = {
        app = "python-web"
      }
    }

    template {
      metadata {
        labels = {
          app = "python-web"
        }
      }

      spec {
        container {
          name  = "python-container"
          # 파이썬 공식 이미지를 사용합니다.
          image = "python:3.9-slim"
          
          # 파이썬 내장 서버 실행 명령 (8080 포트 사용)
          command = ["python", "-m", "http.server", "8080"]

          port {
            container_port = 8080
          }
        }
      }
    }
  }
}

```

### 2.2 `modules/python-web/variables.tf`

```hcl
variable "app_name" {
  description = "애플리케이션 이름"
  type        = string
  default     = "python-web-server"
}

variable "replica_count" {
  description = "Pod(포드) 복제본 개수"
  type        = number
  default     = 2
}

```

---

## 3. Terragrunt 설정 작성 (`live/dev/python-web/`)

### 3.1 `live/dev/python-web/terragrunt.hcl`

이 파일에서 파이썬 모듈을 호출하고 필요한 값을 주입합니다.

```hcl
# 신규 파이썬 모듈 소스 경로 설정
terraform {
  source = "../../../modules/python-web"
}

# 쿠버네티스 공급자 설정 자동 생성
generate "provider" {
  path      = "provider.tf"
  if_exists = "overwrite_terragrunt"
  contents  = <<EOF
provider "kubernetes" {
  config_path = "~/.kube/config"
}
EOF
}

# 파이썬 웹 서버 전용 입력값
inputs = {
  app_name      = "dev-python-web"
  replica_count = 3
}

```

---

## 4. 인프라 배포 및 확인

### 4.1 배포 실행

새로 만든 `python-web` 배포 디렉토리로 이동하여 실행합니다.

```bash
cd ~/k8s-project/live/dev/python-web/

# 초기화 및 배포
terragrunt init
terragrunt apply

```

### 4.2 결과 확인

```bash
# 배포된 파이썬 포드 확인
kubectl get pods -l app=python-web

# 특정 포드의 로그를 통해 서버 구동 확인
# (포드 이름은 실제 실행 결과에 맞춰 수정하세요)
kubectl logs <PYTHON_POD_NAME>

```

> **주석 (Note)**
> * **http.server**: Python 3에 내장된 간단한 HTTP 서버 라이브러리입니다. 별도의 코드 작성 없이 `python -m http.server` 명령으로 웹 서버를 띄울 수 있습니다.
> * **Slim Image**: `python:3.9-slim`은 배포 용량을 줄이기 위해 최소한의 패키지만 포함된 경량화 이미지입니다.
> * **Replica(레플리카)**: 동일한 기능을 하는 포드를 여러 개 띄워 가용성을 확보하는 단위입니다.
> 
> 

---

Next Step: **Helm(헬름) 차트를 이용한 복합 애플리케이션 배포** 본 실습은 사용자 소유의 **Ubuntu VM** 내 **Kubernetes(쿠버네티스)** 환경을 이용하므로 별도의 클라우드 과금은 발생하지 않습니다. 다만, 외부 노출을 위해 Cloud Provider의 **Load Balancer(로드 밸런서)**를 생성할 경우 해당 서비스 이용료가 부과될 수 있습니다.
