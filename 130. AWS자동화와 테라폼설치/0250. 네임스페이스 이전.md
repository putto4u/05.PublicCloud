쿠버네티스에서 각 프로젝트(Nginx, Python, MySQL)에 별도의 **Namespace(네임스페이스)**를 할당하여 격리하려면, 단순히 한 줄만 추가하는 것이 아니라 **'네임스페이스 리소스 생성'**과 **'디플로이먼트의 소속 지정'**이라는 두 가지 작업이 동반되어야 합니다.

가장 효율적으로 관리할 수 있도록 테라폼 모듈을 수정하고 Terragrunt에서 값을 주입하는 과정을 정리해 드립니다.

---

## 1. 테라폼 모듈 수정 (`modules/*/main.tf`)

기존에는 `namespace = "default"`로 고정되어 있거나 생략되었을 것입니다. 이를 변수화하여 가변적으로 바꿉니다.

### 1.1 네임스페이스 리소스 추가 및 연결

모든 프로젝트 모듈의 `main.tf` 상단에 네임스페이스 리소스를 추가하고, 디플로이먼트가 이를 참조하게 만듭니다.

```hcl
# 1. 네임스페이스 리소스 정의
resource "kubernetes_namespace" "app_ns" {
  metadata {
    name = var.namespace_name
  }
}

# 2. 기존 디플로이먼트 수정
resource "kubernetes_deployment" "app" {
  metadata {
    name      = var.deployment_name
    # 위에서 만든 네임스페이스의 이름을 참조
    namespace = kubernetes_namespace.app_ns.metadata[0].name
    labels = { app = var.app_label }
  }
  # ... 이하 spec 생략 ...
}

```

---

## 2. 변수 정의 추가 (`modules/*/variables.tf`)

모듈이 외부(Terragrunt)로부터 네임스페이스 이름을 받을 수 있게 변수를 추가합니다.

```hcl
variable "namespace_name" {
  description = "배포될 쿠버네티스 네임스페이스 이름"
  type        = string
  default     = "default"
}

```

---

## 3. Terragrunt에서 네임스페이스 지정 (`live/dev/*/terragrunt.hcl`)

이제 각 프로젝트의 설정 파일에서 **단 한 줄**(`namespace_name`)을 추가하여 프로젝트별로 다른 이름을 부여할 수 있습니다.

### 3.1 Nginx 설정 예시

```hcl
inputs = {
  deployment_name = "nginx-server"
  replica_count   = 3
  namespace_name  = "web-service" # 이 한 줄로 네임스페이스 지정
}

```

### 3.2 MySQL 설정 예시

```hcl
inputs = {
  db_name        = "mysql-db"
  root_password  = "password123!"
  namespace_name = "database-service" # DB 전용 네임스페이스
}

```

---

## 4. 운영 및 확인

### 4.1 적용 실행

모든 설정이 완료되었다면 `run-all`로 일괄 적용합니다.

```bash
cd ~/k8s-project/live/dev/
terragrunt run-all apply

```

### 4.2 결과 확인

네임스페이스별로 리소스가 잘 나누어졌는지 확인합니다.

```bash
# 전체 네임스페이스 목록 확인
kubectl get ns

# 특정 네임스페이스의 포드만 확인
kubectl get pods -n web-service
kubectl get pods -n database-service

```

---

## 5. 핵심 요약

> **주석 (Note)**
> * **Namespace (네임스페이스)**: 쿠버네티스 클러스터 하나를 여러 개의 논리적인 가상 클러스터로 나누는 단위입니다. 팀별, 환경별(Dev/Prod), 용도별(Web/DB)로 리소스를 격리할 때 사용합니다.
> * **Resource Reference (리소스 참조)**: 테라폼에서 `kubernetes_namespace.app_ns.metadata[0].name`과 같이 작성하면, 네임스페이스가 생성된 후 그 이름을 받아와서 디플로이먼트를 생성하므로 순서가 꼬이지 않습니다.
> 
> 

---

Next Step: **Resource Quota(리소스 쿼터) 설정을 통한 네임스페이스별 자원 제한**

본 실습은 **Ubuntu VM** 내부의 논리적 구분이므로 추가 과금이 발생하지 않습니다. 다만, 클라우드 환경에서 네임스페이스를 나누어 관리할 때, 각 네임스페이스가 사용하는 전체 자원(CPU, Memory)을 제한하지 않으면 특정 서비스가 클러스터 전체 자원을 고갈시켜 비용 상승이나 타 서비스 장애를 유발할 수 있으므로 주의가 필요합니다.

Next Step: 네임스페이스별 자원 제한 설정

**지정하신 교재 형식에 맞춰 수정 및 보완되었습니다.**
