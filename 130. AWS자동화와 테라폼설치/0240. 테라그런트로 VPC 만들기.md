이번 과정에서는 **Terragrunt(테라그런트)**를 사용하여 **AWS(Amazon Web Services)** 환경에 가장 기초적인 네트워크 기반인 **VPC(Virtual Private Cloud, 가상 프라이빗 클라우드)**를 구축하는 실습을 진행합니다.

---

## 1. AWS VPC 개요

**VPC(가상 프라이빗 클라우드)**는 AWS 클라우드 내에서 사용자 전용의 격리된 네트워크 섹션을 할당받는 서비스입니다. 테라폼의 공식 **AWS VPC Module**을 사용하여 표준화된 네트워크 환경을 구축합니다.

---

## 2. 프로젝트 디렉토리 구조 확장

기존 `k8s-project` 구조에 AWS 네트워크 관리를 위한 디렉토리를 추가합니다.

```text
k8s-project/
├── modules/
│   └── aws-vpc/            # AWS VPC 테라폼 모듈
│       ├── main.tf
│       ├── variables.tf
│       └── outputs.tf
└── live/
    └── dev/
        └── aws-vpc/        # VPC 배포 설정 (Terragrunt)

```

---

## 3. 테라폼 모듈 작성 (`modules/aws-vpc/`)

### 3.1 `modules/aws-vpc/main.tf`

AWS에서 권장하는 멀티 가용 영역(Multi-AZ) 구조의 VPC를 생성합니다.

```hcl
resource "aws_vpc" "main" {
  cidr_block           = var.vpc_cidr
  enable_dns_hostnames = true
  enable_dns_support   = true

  tags = {
    Name = var.vpc_name
  }
}

resource "aws_subnet" "public" {
  count             = 2
  vpc_id            = aws_vpc.main.id
  cidr_block        = var.public_subnets[count.index]
  availability_zone = var.azs[count.index]

  tags = {
    Name = "${var.vpc_name}-public-${count.index + 1}"
  }
}

```

### 3.2 `modules/aws-vpc/variables.tf`

```hcl
variable "vpc_name" {
  type    = string
  default = "my-aws-vpc"
}

variable "vpc_cidr" {
  type    = string
  default = "10.0.0.0/16"
}

variable "public_subnets" {
  type    = list(string)
  default = ["10.0.1.0/24", "10.0.2.0/24"]
}

variable "azs" {
  type    = list(string)
  default = ["ap-northeast-2a", "ap-northeast-2c"]
}

```

---

## 4. Terragrunt 설정 작성 (`live/dev/aws-vpc/`)

### 4.1 `live/dev/aws-vpc/terragrunt.hcl`

AWS 리소스를 생성하기 위해서는 **AWS Provider** 설정이 반드시 필요합니다.

```hcl
terraform {
  source = "../../../modules/aws-vpc"
}

# AWS Provider 자동 생성
generate "provider" {
  path      = "provider.tf"
  if_exists = "overwrite_terragrunt"
  contents  = <<EOF
provider "aws" {
  region = "ap-northeast-2" # 서울 리전
}
EOF
}

# VPC 상세 설정값 주입
inputs = {
  vpc_name       = "dev-vpc"
  vpc_cidr       = "172.16.0.0/16"
  public_subnets = ["172.16.1.0/24", "172.16.2.0/24"]
  azs            = ["ap-northeast-2a", "ap-northeast-2c"]
}

```

---

## 5. 인프라 배포 및 확인

### 5.1 배포 전 필수 사항

AWS CLI가 설치되어 있고, 적절한 권한을 가진 IAM 계정의 Access Key가 설정되어 있어야 합니다. (`aws configure` 명령어로 설정)

### 5.2 실행 과정

```bash
cd ~/k8s-project/live/dev/aws-vpc/

# 초기화 및 배포
terragrunt init
terragrunt apply

```

### 5.3 결과 확인

배포 완료 후 AWS 콘솔 혹은 CLI를 통해 생성된 VPC 정보를 확인합니다.

```bash
aws ec2 describe-vpcs --filters "Name=tag:Name,Values=dev-vpc"

```

---

## 6. 학습 요약 및 주의사항

> **주석 (Note)**
> * **CIDR (Classless Inter-Domain Routing, 사이더)**: IP 주소 할당 방법으로, 네트워크 범위를 지정합니다. (예: `172.16.0.0/16`)
> * **Availability Zone (AZ, 가용 영역)**: 하나의 리전 내에서 물리적으로 격리된 데이터 센터 집합입니다. 고가용성을 위해 최소 2개 이상의 AZ를 사용합니다.
> * **Subnet (서브넷)**: VPC의 IP 주소 범위를 더 작은 범위로 나눈 네트워크 단위입니다.
> 
> 

---

Next Step: **Internet Gateway(인터넷 게이트웨이) 및 Route Table(라우트 테이블) 설정**

**과금 알림**: 본 실습에서 생성하는 **VPC(가상 프라이빗 클라우드)** 자체는 무료 서비스입니다. 하지만 VPC 내에 **NAT Gateway(네트워크 주소 변환 게이트웨이)**를 추가하거나, 고정 IP인 **EIP(Elastic IP Address)**를 할당하고 사용하지 않을 경우 비용이 발생하므로 실습 후에는 반드시 `terragrunt destroy`로 자원을 삭제해 주세요.

Next Step: AWS 네트워크 게이트웨이 설정 방법
